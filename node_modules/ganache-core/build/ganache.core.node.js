!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Ganache",[],e):"object"==typeof exports?exports.Ganache=e():t.Ganache=e()}(global,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=25)}([function(t,e,n){let r=n(3);t.exports={buffer:function(t){let e;return"string"==typeof t?(e=(e=0===t.indexOf("0x")?t.slice(2):t).length%2==1?`0${e}`:e,e=Buffer.from(e,"hex")):e=Buffer.isBuffer(t)?t:Buffer.from(t),e},hex:function(t){if("string"==typeof t){if(0===t.indexOf("0x"))return t.trim();t=new r.BN(t)}if("boolean"==typeof t&&(t=t?1:0),"number"==typeof t)t=r.intToHex(t);else{if(null==t)return"0x";"object"==typeof t&&(t=t.toString("hex"))}return r.addHexPrefix(t)},_rpcQuantityHexString:function(t){return t=(t=this.hex(t)).replace(/^(?:0x)(?:0+(.+?))?$/,"0x$1")},rpcQuantityHexString:function(t){return"0x"===(t=this._rpcQuantityHexString(t))&&(t="0x0"),t},rpcDataHexString:function(t,e){if("number"==typeof e)t=this.hex(t).replace("0x",""),t=new Array(e-t.length).fill("0").join("")+t;else{if(0===t.length)return"0x";(t=this.hex(t).replace("0x","")).length%2!=0&&(t="0"+t)}return"0x"+t},nullableRpcDataHexString:function(t,e){if(null===t)return null;{const n=this.rpcDataHexString(t,e);return"0x"===n?null:n}},nullableRpcQuantityHexString:function(t,e){if(null===t)return null;{const n=this._rpcQuantityHexString(t,e);return"0x"===n?null:n}},hexWithZeroPadding:function(t){const e=(t=this.hex(t)).replace("0x","");return 1&e.length?"0x0"+e:t},number:function(t){if("number"==typeof t)return t;if("string"==typeof t&&0!==t.indexOf("0x"))return parseInt(t,10);var e=r.toBuffer(t);return r.bufferToInt(e)},rpcError:function(t,e,n){return JSON.stringify({jsonrpc:"2.0",id:t,error:{code:e,message:n}})}}},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("async")},function(t,e){t.exports=require("ethereumjs-util")},function(t,e){t.exports=require("web3-provider-engine/subproviders/subprovider.js")},function(t,e){t.exports=require("bn.js")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("source-map-support/register")},function(t,e){t.exports=require("ethereumjs-account")},function(t,e,n){var r=n(1).inherits,o=n(0),i=n(33);function s(t,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.results={},this.hashes=[],this.combine(t,e)}r(s,Error),s.prototype.combine=function(t,e){if(t instanceof s)for(var n=t,r=Object.keys(n.results),a=0;a<r.length;a++){var c=r[a];this.results[c]=n.results[c],Array.prototype.push.apply(this.hashes,n.hashes)}else{var u=e.results;for(a=0;a<t.length;a++){var l=t[a],h=u[a];if(1!==h.vm.exception){var p,f=o.hex(l.hash());this.hashes.push(f);var d=h.vm.return;d&&"08c379a0"===d.slice(0,4).toString("hex")&&(p=i.rawDecode(["string"],d.slice(4))[0]),this.results[f]={error:h.vm.exceptionError.error||h.vm.exceptionError,program_counter:h.vm.runState.programCounter,return:o.hex(h.vm.return),reason:p}}}}if(1===this.hashes.length){var g=this.results[this.hashes[0]],m="VM Exception while processing transaction: "+g.error;g.reason&&(m+=" "+g.reason),this.message=m}else{for(m="Multiple VM Exceptions while processing transactions: \n\n",a=0;a<this.hashes.length;a++)m+=(f=this.hashes[a])+": "+(g=this.results[f]).error,g.reason&&(m+=" "+g.reason),m+="\n";this.message=m}},s.prototype.count=function(){return Object.keys(this.results).length},s.fromResults=function(t,e){var n=new s(t,e);return 0===n.count()?null:n},t.exports=s},function(t,e,n){const r=n(34),o=n(35),i=n(3),s=n(36),a=n(37),c=n(0),u=r.prototype.sign,l=function(){return null!=this._hash?this._hash:o.prototype.hash.apply(this,arguments)},h=Buffer.from([0]);function p(t,e){t._originals=[];["nonce","gasPrice","gasLimit","value"].forEach(e=>(function(t,e,n=32){const r=t._fields.indexOf(e),o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(t,e,{set:a=>{o.set.call(t,a),a=i.toBuffer(a),s(n>=a.length,`The field ${e} must not have more ${n} bytes`),t._originals[r]=a},get:()=>t._originals[r]})})(t,e,32));const n=Object.getOwnPropertyDescriptor(t,"v");Object.defineProperty(t,"v",{set:e=>{n.set.call(t,e);const r=i.bufferToInt(t.v);let o=Math.floor((r-35)/2);o<0&&(o=0),t._chainId=o||0}}),t.isFake()&&(Object.defineProperty(t,"from",{enumerable:!0,configurable:!0,get:t.getSenderAddress.bind(t),set:e=>{t._from=e?i.toBuffer(e):null}}),e&&e.from&&(t.from=e.from),t.hash=l)}t.exports=class t extends r{constructor(e,n=t.types.none){super(),this.type=n,p(this,e),function(t,e){if(e){"string"==typeof e&&(e=c.buffer(e)),Buffer.isBuffer(e)&&(e=a.decode(e));const n=t;if(Array.isArray(e)){if(e.length>t._fields.length)throw new Error("wrong number of fields in data");e.forEach((t,e)=>{n[n._fields[e]]=i.toBuffer(t)})}else{if("object"!=(void 0===e?"undefined":typeof e))throw new Error("invalid data");{const r=Object.keys(e);t._fields.forEach(function(t){-1!==r.indexOf(t)&&(n[t]=e[t]),"gasLimit"===t?-1!==r.indexOf("gas")&&(n.gas=e.gas):"data"===t&&-1!==r.indexOf("input")&&(n.input=e.input)}),!t._chainId&&e&&null!=e.chainId&&(t.raw[n._fields.indexOf("v")]=t._chainId=e.chainId||0)}}}}(this,e)}static get types(){return{none:0,signed:1,fake:2}}static fromJSON(e,n){let r;if(e.to){const t=c.buffer(e.to);r=t.equals(Buffer.from([0]))?i.setLengthLeft(t,20):t}const o=e.data||e.input,s={nonce:i.toBuffer(c.hex(e.nonce)),from:i.toBuffer(c.hex(e.from)),value:i.toBuffer(c.hex(e.value)),gasLimit:i.toBuffer(c.hex(e.gas||e.gasLimit)),gasPrice:i.toBuffer(c.hex(e.gasPrice)),data:o?c.buffer(o):null,to:r,v:i.toBuffer(e.v),r:i.toBuffer(e.r),s:i.toBuffer(e.s)},a=new t(s,n);return a._hash=e.hash?c.buffer(e.hash):null,a}encode(){return{hash:c.nullableRpcDataHexString(this.hash()),nonce:c.nullableRpcQuantityHexString(this.nonce)||"0x",from:c.rpcDataHexString(this.from),to:c.nullableRpcDataHexString(this.to),value:c.nullableRpcQuantityHexString(this.value),gas:c.nullableRpcQuantityHexString(this.gasLimit),gasPrice:c.nullableRpcQuantityHexString(this.gasPrice),data:this.data?this.data.toString("hex"):null,v:c.nullableRpcQuantityHexString(this.v),r:c.nullableRpcDataHexString(this.r),s:c.nullableRpcDataHexString(this.s),_type:this.type}}isFake(){return(this.type&t.types.fake)===t.types.fake}isSigned(){return(this.type&t.types.signed)===t.types.signed}validateNonce(t){let e;return(e=this.isSigned()&&0===this.nonce.length?h:this.nonce).equals(t)}sign(){u.apply(this,arguments),this.type|=t.types.signed}toJsonRpc(t){const e=this.hash();let n=null;for(let r=0,o=t.transactions,i=o.length;r<i;r++)if(o[r].hash().equals(e)){n=r;break}return{hash:c.nullableRpcDataHexString(e),nonce:c.rpcQuantityHexString(this.nonce),blockHash:c.nullableRpcDataHexString(t.hash()),blockNumber:c.nullableRpcQuantityHexString(t.header.number),transactionIndex:c.nullableRpcQuantityHexString(n),from:c.rpcDataHexString(this.from),to:c.nullableRpcDataHexString(this.to),value:c.rpcQuantityHexString(this.value),gas:c.rpcQuantityHexString(this.gasLimit),gasPrice:c.rpcQuantityHexString(this.gasPrice),input:c.rpcDataHexString(this.data),v:c.nullableRpcQuantityHexString(this.v),r:c.nullableRpcDataHexString(this.r),s:c.nullableRpcDataHexString(this.s)}}hash(t=!0){let e;if(t)e=this.raw;else{const t=this._chainId;if(t>0){const n=this.raw.slice();this.v=t,this.r=0,this.s=0,e=this.raw,this.raw=n,this._chainId=t}else e=this.raw.slice(0,6)}return i.rlphash(e)}}},function(t,e){t.exports=require("ethereumjs-block")},function(t,e,n){var r=n(0);function o(t){var e=this;Object.keys(t).forEach(function(n){e[n]=t[n]})}o.prototype.toJSON=function(){return{logIndex:r.rpcQuantityHexString(this.logIndex),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),transactionHash:r.rpcDataHexString(this.transactionHash),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),address:r.rpcDataHexString(this.address),data:r.rpcDataHexString(this.data),topics:this.topics,type:"mined"}},t.exports=o},function(t,e,n){var r=n(0);function o(t,e,n,r,o,i,s,a){this.tx=t,this.block=e,this.logs=n,this.gasUsed=r,this.cumulativeGasUsed=o,this.contractAddress=i,this.status=s,this.logsBloom=a,this.transactionIndex=0,this.txHash=t.hash();for(var c=0;c<e.transactions.length;c++){if(e.transactions[c].hash().equals(this.txHash)){this.transactionIndex=c;break}}}o.prototype.toJSON=function(){return{transactionHash:r.rpcDataHexString(this.txHash),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),from:r.rpcDataHexString(this.tx.from),to:r.nullableRpcDataHexString(this.tx.to),gasUsed:r.rpcQuantityHexString(this.gasUsed),cumulativeGasUsed:r.rpcQuantityHexString(this.cumulativeGasUsed),contractAddress:null!=this.contractAddress?r.rpcDataHexString(this.contractAddress):null,logs:this.logs.map(function(t){return t.toJSON()}),status:r.rpcQuantityHexString(this.status),logsBloom:r.rpcDataHexString(this.logsBloom),v:r.rpcDataHexString(this.tx.v),r:r.rpcDataHexString(this.tx.r),s:r.rpcDataHexString(this.tx.s)}},t.exports=o},function(t,e){class n extends Error{constructor(t,e,n){super("LevelUpArrayAdapter named '"+t+"' index out of range: index "+e+"; length: "+n),this.name=`${this.constructor.name}:${t}`,this.type=t}}t.exports={LevelUpOutOfRangeError:n,BlockOutOfRangeError:class extends n{constructor(t,e){super("blocks",t,e)}}}},function(t,e){t.exports=require("events")},function(t,e,n){"use strict";var r=n(69).version,o=n(70),i=n(71),s=n(72),a=n(73),c=n(74),u=n(75),l=n(76),h=function(){var t=this;o.packageInit(this,arguments),this.version=r,this.utils=l,this.eth=new i(this),this.shh=new c(this),this.bzz=new u(this);var e=this.setProvider;this.setProvider=function(n,r){return e.apply(t,arguments),this.eth.setProvider(n,r),this.shh.setProvider(n,r),this.bzz.setProvider(n),!0}};h.version=r,h.utils=l,h.modules={Eth:i,Net:s,Personal:a,Shh:c,Bzz:u},o.addProviders(h),t.exports=h},function(t,e,n){n(7);let r=n(26),o=n(27),i=n(28),s=n(29),a=n(30),c=n(31),u=n(80),l=n(9),h=n(15),p=n(6);function f(t){const e=this;h.call(this),this.options=t=e._applyDefaultOptions(t||{});let n=new c(t,this);this.engine=new r({blockTracker:new u({blockchain:n.state.blockchain})});let l=new o;this.engine.manager=n,this.engine.addProvider(new i),this.engine.addProvider(new s),this.engine.addProvider(l),this.engine.addProvider(new a),this.engine.addProvider(n),this.engine.setMaxListeners(100),this.engine.start(),this.manager=n,this.sendAsync=this.send.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),this._queueRequest=this._queueRequest.bind(this),this._processRequestQueue=this._processRequestQueue.bind(this),l.on("data",function(t,n){e.emit("data",t,n)})}const d={vmErrorsOnRPCResponse:!0,verbose:!1,asyncRequestProcessing:!1,logger:{log:function(){}}};f.prototype=Object.create(h.prototype),f.prototype.constructor=f,f.prototype._applyDefaultOptions=function(t){return p.merge({},d,t)},f.prototype.send=function(t,e){if("function"!=typeof e)throw new Error("No callback provided to provider's send function. As of web3 1.0, provider.send is no longer synchronous and must be passed a callback as its final argument.");let n=this,r=function(t){return p.cloneDeep(t)};t=Array.isArray(t)?t.map(r):r(t);let o=function(r,o){let i;if(o=p.cloneDeep(o),Array.isArray(o)){i=[];for(let e=0;e<o.length;e++)i.push(n.reportErrorInResponse(t[e],r,o[e]))}else i=n.reportErrorInResponse(t,r,o);n.options.verbose&&n.options.logger.log(" <   "+JSON.stringify(i,null,2).split("\n").join("\n <   ")),process.nextTick(()=>e(i.error?r:null,i))};n.options.verbose&&n.options.logger.log("   > "+JSON.stringify(t,null,2).split("\n").join("\n   > ")),n.options.asyncRequestProcessing?n.engine.sendAsync(t,o):n._queueRequest(t,o)},f.prototype.close=function(t){this.manager.state.stopMining(),this.manager.state.blockchain.close(t),this.engine.stop()},f.prototype._queueRequest=function(t,e){this._requestQueue||(this._requestQueue=[]),this._requestQueue.push({payload:t,callback:e}),setImmediate(this._processRequestQueue)},f.prototype._processRequestQueue=function(){const t=this;if(t._requestInProgress)return;t._requestInProgress=!0;let e=t._requestQueue.shift();e?t.engine.sendAsync(e.payload,(n,r)=>{t._requestQueue.length>0&&setImmediate(t._processRequestQueue),e.callback(n,r),t._requestInProgress=!1}):(t._requestInProgress=!1,t._requestQueue.length>0&&setImmediate(t._processRequestQueue))},f.prototype.cleanUpErrorObject=function(t,e){if(!t||!e.error)return e;let n={error:{data:{}}};return t.message?(n.error.message=t.message,n.error.data.stack=t.stack,n.error.data.name=t.name):e.error||(n.error={message:t.toString()}),p.merge(e,n)};let g=["eth_sendTransaction","eth_sendRawTransaction","personal_sendTransaction"];f.prototype._isTransactionRequest=function(t){return-1!==g.indexOf(t.method)},f.prototype.reportErrorInResponse=function(t,e,n){const r=this;return e?(r._isTransactionRequest(t)&&e instanceof l&&(n.result=e.hashes[0],r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[e.hashes[0]]=e.results[e.hashes[0]]):delete n.error),"eth_call"===t.method&&e instanceof l&&(r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[e.hashes[0]]=e.results[e.hashes[0]]):(n.result=e.results[e.hashes[0]].return||"0x",delete n.error)),r.cleanUpErrorObject(e,n)):n},t.exports=f},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=n(40).Buffer,i=n(3),s=n(41),a=n(42),c=n(43),u=n(44);function l(t,e){if(!t)throw new Error(e||"Assertion failed")}function h(t,e){return o.concat([t.update(e),t.final()])}var p=function(t,e){if(t&&e)throw new Error("Cannot supply both a private and a public key to the constructor");if(t&&!i.isValidPrivate(t))throw new Error("Private key does not satisfy the curve requirements (ie. it is invalid)");if(e&&!i.isValidPublic(e))throw new Error("Invalid public key");this._privKey=t,this._pubKey=e};Object.defineProperty(p.prototype,"privKey",{get:function(){return l(this._privKey,"This is a public key only wallet"),this._privKey}}),Object.defineProperty(p.prototype,"pubKey",{get:function(){return this._pubKey||(this._pubKey=i.privateToPublic(this.privKey)),this._pubKey}}),p.generate=function(t){if(!t)return new p(s.randomBytes(32));for(var e=new i.BN("088f924eeceeda7fe92e1f5b0fffffffffffffff",16);;){var n=s.randomBytes(32);if(new i.BN(i.privateToAddress(n)).lte(e))return new p(n)}},p.generateVanityAddress=function(t){for("object"!==(void 0===t?"undefined":r(t))&&(t=new RegExp(t));;){var e=s.randomBytes(32),n=i.privateToAddress(e);if(t.test(n.toString("hex")))return new p(e)}},p.prototype.getPrivateKey=function(){return this.privKey},p.prototype.getPrivateKeyString=function(){return i.bufferToHex(this.getPrivateKey())},p.prototype.getPublicKey=function(){return this.pubKey},p.prototype.getPublicKeyString=function(){return i.bufferToHex(this.getPublicKey())},p.prototype.getAddress=function(){return i.publicToAddress(this.pubKey)},p.prototype.getAddressString=function(){return i.bufferToHex(this.getAddress())},p.prototype.getChecksumAddressString=function(){return i.toChecksumAddress(this.getAddressString())},p.prototype.toV3=function(t,e){l(this._privKey,"This is a public key only wallet");var n,r=(e=e||{}).salt||s.randomBytes(32),u=e.iv||s.randomBytes(16),h=e.kdf||"scrypt",p={dklen:e.dklen||32,salt:r.toString("hex")};if("pbkdf2"===h)p.c=e.c||262144,p.prf="hmac-sha256",n=s.pbkdf2Sync(o.from(t),r,p.c,p.dklen,"sha256");else{if("scrypt"!==h)throw new Error("Unsupported kdf");p.n=e.n||262144,p.r=e.r||8,p.p=e.p||1,n=a(o.from(t),r,p.n,p.r,p.p,p.dklen)}var f=s.createCipheriv(e.cipher||"aes-128-ctr",n.slice(0,16),u);if(!f)throw new Error("Unsupported cipher");var d=o.concat([f.update(this.privKey),f.final()]),g=i.sha3(o.concat([n.slice(16,32),o.from(d,"hex")]));return{version:3,id:c({random:e.uuid||s.randomBytes(16)}),address:this.getAddress().toString("hex"),crypto:{ciphertext:d.toString("hex"),cipherparams:{iv:u.toString("hex")},cipher:e.cipher||"aes-128-ctr",kdf:h,kdfparams:p,mac:g.toString("hex")}}},p.prototype.getV3Filename=function(t){return["UTC--",(t?new Date(t):new Date).toJSON().replace(/:/g,"-"),"--",this.getAddress().toString("hex")].join("")},p.prototype.toV3String=function(t,e){return JSON.stringify(this.toV3(t,e))},p.fromPublicKey=function(t,e){return e&&(t=i.importPublic(t)),new p(null,t)},p.fromExtendedPublicKey=function(t){return l("xpub"===t.slice(0,4),"Not an extended public key"),t=u.decode(t).slice(45),p.fromPublicKey(t,!0)},p.fromPrivateKey=function(t){return new p(t)},p.fromExtendedPrivateKey=function(t){l("xprv"===t.slice(0,4),"Not an extended private key");var e=u.decode(t);return l(0===e[45],"Invalid extended private key"),p.fromPrivateKey(e.slice(46))},p.fromV1=function(t,e){l("string"==typeof e);var n="object"===(void 0===t?"undefined":r(t))?t:JSON.parse(t);if("1"!==n.Version)throw new Error("Not a V1 wallet");if("scrypt"!==n.Crypto.KeyHeader.Kdf)throw new Error("Unsupported key derivation scheme");var c=n.Crypto.KeyHeader.KdfParams,u=a(o.from(e),o.from(n.Crypto.Salt,"hex"),c.N,c.R,c.P,c.DkLen),f=o.from(n.Crypto.CipherText,"hex");if(i.sha3(o.concat([u.slice(16,32),f])).toString("hex")!==n.Crypto.MAC)throw new Error("Key derivation failed - possibly wrong passphrase");var d=h(s.createDecipheriv("aes-128-cbc",i.sha3(u.slice(0,16)).slice(0,16),o.from(n.Crypto.IV,"hex")),f);return new p(d)},p.fromV3=function(t,e,n){l("string"==typeof e);var c,u,f="object"===(void 0===t?"undefined":r(t))?t:JSON.parse(n?t.toLowerCase():t);if(3!==f.version)throw new Error("Not a V3 wallet");if("scrypt"===f.crypto.kdf)u=f.crypto.kdfparams,c=a(o.from(e),o.from(u.salt,"hex"),u.n,u.r,u.p,u.dklen);else{if("pbkdf2"!==f.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(u=f.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");c=s.pbkdf2Sync(o.from(e),o.from(u.salt,"hex"),u.c,u.dklen,"sha256")}var d=o.from(f.crypto.ciphertext,"hex");if(i.sha3(o.concat([c.slice(16,32),d])).toString("hex")!==f.crypto.mac)throw new Error("Key derivation failed - possibly wrong passphrase");var g=h(s.createDecipheriv(f.crypto.cipher,c.slice(0,16),o.from(f.crypto.cipherparams.iv,"hex")),d);return new p(g)},p.fromEthSale=function(t,e){l("string"==typeof e);var n="object"===(void 0===t?"undefined":r(t))?t:JSON.parse(t),a=o.from(n.encseed,"hex"),c=s.pbkdf2Sync(e,e,2e3,32,"sha256").slice(0,16),u=h(s.createDecipheriv("aes-128-cbc",c,a.slice(0,16)),a.slice(16)),f=new p(i.sha3(u));if(f.getAddress().toString("hex")!==n.ethaddr)throw new Error("Decoded key mismatch - possibly wrong passphrase");return f},t.exports=p},function(t,e,n){var r=n(0),o=n(8),i=n(11),s=n(12),a=n(13),c=n(47),u=n(9),l=n(20),h=n(3),p=n(2),f=n(48),d=n(49),g=n(15),m=n(64),b=n(6),y=n(1).promisify;const k=n(5);function v(t){if(g.apply(this),this.options=t=this._applyDefaultOptions(t||{}),this.logger=t.logger||console,this.data=new d(t),null!=t.trie&&null!=t.db_path)throw new Error("Can't initialize a TestRPC with a db and a custom trie.");this.pending_transactions=[],this.blockGasLimit=t.gasLimit,this.defaultTransactionGasLimit=t.defaultTransactionGasLimit,this.timeAdjustment=0}const x={gasLimit:"0x6691b7",defaultTransactionGasLimit:"0x15f90",time:null,debug:!1,hardfork:"petersburg",allowUnlimitedContractSize:!1};v.prototype=Object.create(g.prototype),v.prototype.constructor=v,v.prototype._applyDefaultOptions=function(t){return b.merge(t,x,Object.assign({},t))},v.prototype.initialize=function(t,e){var n=this;this.data.initialize(function(r){if(r)return e(r);n.latestBlock(function(r,o){if(r)return e(r);var i=n.options,s=null;if(o&&(s=o.header.stateRoot),n.stateTrie=n.createStateTrie(n.data.trie_db,s),n.vm=i.vm||n.createVMFromStateTrie(n.stateTrie,!0),i.time&&n.setTime(i.time),o)return n.emit("block",o),e();n.createGenesisBlock(function(r,o){if(r)return e(r);t=t||[],n.vm.stateManager.checkpoint(()=>{p.eachSeries(t,function(t,e){n.vm.stateManager.putAccount(h.toBuffer(t.address),t.account,e)},function(t){if(t)return e(t);n.vm.stateManager.commit(()=>{n.putBlock(o,[],[],e)})})})})})})},v.prototype.createVMFromStateTrie=function(t,e){const n=this,o=new c({state:t,blockchain:{getBlock:function(t,e){try{t=r.number(t)}catch(t){}n.getBlock(t,e)}},activatePrecompiles:e||!1,hardfork:n.options.hardfork,allowUnlimitedContractSize:n.options.allowUnlimitedContractSize});return!0===n.options.debug&&o.on("step",function(t){var e=t.opcode.name,o=t.opcode.in;if(o){var i=t.stack.slice(-o).map(t=>r.hex(t)).join(" ");n.logger.log(`${e} ${i}`)}else n.logger.log(e)}),o},v.prototype.createStateTrie=function(t,e){return new l(t,e)},v.prototype.createGenesisBlock=function(t){this.createBlock(t)},v.prototype.latestBlock=function(t){this.data.blocks.last(function(e,n){if(e)return t(e);t(null,n)})},v.prototype.getEffectiveBlockNumber=function(t,e){return"string"!=typeof t&&(t=r.hex(t)),t.indexOf("0x")>=0?e(null,r.number(t)):"latest"===t||"pending"===t?this.getHeight(e):"earliest"===t?e(null,0):void 0},v.prototype.getBlock=function(t,e){var n=this;if("string"!=typeof t&&(t=r.hex(t)),t.indexOf("0x")>=0){var o=t;if(!(o.length>40))return this.data.blocks.get(r.number(o),e);this.data.blockHashes.get(r.hex(o),function(t,r){return t?e(t):n.data.blocks.get(r,e)})}else{if("latest"===t||"pending"===t)return this.latestBlock(e);if("earliest"===t)return this.data.blocks.first(e);process.nextTick(e,new Error('Invalid `blockNumber`: "'+t+'"'))}},v.prototype.putBlock=function(t,e,n,o){var i=this;t.header.stateRoot=this.stateTrie.root,this.data.blocks.length(function(s,a){if(s)return o(s);var c=[i.data.blocks.push.bind(i.data.blocks,t),i.data.blockLogs.push.bind(i.data.blockLogs,e),i.data.blockHashes.set.bind(i.data.blockHashes,r.hex(t.hash()),a)];t.transactions.forEach(function(t,e){var o=r.hex(t.hash());c.push(i.data.transactions.set.bind(i.data.transactions,o,t),i.data.transactionReceipts.set.bind(i.data.transactionReceipts,o,n[e]))}),p.parallel(c,(e,n)=>{e||i.emit("block",t),o(e,n)})})},v.prototype.popBlock=function(t){var e=this;this.data.blocks.last(function(n,o){if(n)return t(n);if(null==o)return t(null,null);var i=[],s=r.hex(o.hash());o.transactions.forEach(function(t){var n=r.hex(t.hash());i.push(e.data.transactions.del.bind(e.data.transactions,n),e.data.transactionReceipts.del.bind(e.data.transactionReceipts,n))}),i.push(e.data.blockLogs.pop.bind(e.data.blockLogs),e.data.blockHashes.del.bind(e.data.blockHashes,s),e.data.blocks.pop.bind(e.data.blocks)),p.series(i,function(n){if(n)return t(n);e.data.blocks.last(function(n,r){if(n)return t(n);e.vm.stateManager.setStateRoot(r.header.stateRoot,function(n){n||(e.vm.stateManager._storageTries={}),t(n,o)})})})})},v.prototype.clearPendingTransactions=function(){this.pending_transactions=[]},v.prototype.createBlock=function(t,e){var n=this;"function"==typeof t&&(e=t,t=null);var o=new i;!function(e){if(t)return e(null,t);n.latestBlock(e)}(function(t,i){if(t)return e(t);var s=null!=i?r.number(i.header.number):-1;o.header.gasLimit=n.blockGasLimit,o.header.number=r.hex(s+1),o.header.timestamp=r.hex(n.currentTime()),null!=i&&(o.header.parentHash=r.hex(i.hash())),e(null,o)})},v.prototype.getQueuedNonce=function(t,e){var n=null,i=r.buffer(t);if(this.pending_transactions.forEach(function(t){if(t.from.equals(i)){var e=new k(t.nonce);(null===n||e.gt(n))&&(n=e)}}),null!=n)return e(null,n.iaddn(1).toArrayLike(Buffer));this.stateTrie.get(i,function(t,n){if(t)return e(t);var r=new o(n);e(null,0===r.nonce.length?Buffer.from([0]):r.nonce)})},v.prototype.queueTransaction=function(t){this.pending_transactions.push(t)},v.prototype.sortByPriceAndNonce=function(){var t={};this.pending_transactions.forEach(e=>{const n=e.from.toString("hex"),r=t[n];r?r.push(e):t[n]=[e]});var e=function(t,e){return parseInt(r.hex(t.nonce),16)-parseInt(r.hex(e.nonce),16)};Object.keys(t).forEach(n=>{t[n].sort(e)});var n=new f(function(t,e){return parseInt(r.hex(e.gasPrice),16)-parseInt(r.hex(t.gasPrice),16)});Object.keys(t).forEach(e=>{n.push(t[e].shift())});const o=[];for(;n.size()>0;){const e=n.pop();let r=e.from.toString("hex");t[r].length>0&&n.push(t[r].shift()),o.push(e)}this.pending_transactions=o},v.prototype.processCall=function(t,e,n){var r=this,o=function(t,e,o){if(e)return n(e);r.createBlock(o,function(e,i){if(e)return n(e);i.transactions.push(t);var s={tx:t,block:i,skipBalance:!0,skipNonce:!0},a=r.createStateTrie(r.data.trie_db,o.header.stateRoot);r.createVMFromStateTrie(a).runTx(s,function(r,o){if(r&&r instanceof Error==!1&&(r=new Error("VM error: "+r)),r)return n(r,e);r=u.fromResults([t],{results:[o]}),n(r,o)})})};"latest"===e?r.latestBlock(o.bind(null,t)):r.getBlock(e,o.bind(null,t))},v.prototype.estimateGas=function(t,e,n){var r=this,o=function(t,e,o){if(e)return n(e);r.createBlock(o,function(e,i){if(e)return n(e);i.transactions.push(t);var s={tx:t,block:i,skipBalance:!0,skipNonce:!0},a=r.createStateTrie(r.data.trie_db,o.header.stateRoot),c=r.createVMFromStateTrie(a);m(c,s,e,n)})};"latest"===e?r.latestBlock(o.bind(null,t)):r.getBlock(e,o.bind(null,t))},v.prototype.processBlock=function(t,e,n,o){var i=this;"function"==typeof n&&(o=n,n=!0),t.runBlock({block:e,generate:!0,skipBlockValidation:!0},async function(t,c){if(t&&t instanceof Error==!1&&(t=new Error("VM error: "+t)),t)return void o(t);t=u.fromResults(e.transactions,c);var p=[],f=[],d=0;c.results.forEach(function(t){d+=r.number(t.gasUsed)}),e.header.gasUsed=h.toBuffer(r.hex(d));const g=new l,m=new l,b=[],k=(t,e,n)=>y(t.put.bind(t))(e,n);for(var v=0;v<c.receipts.length;v++){var x=c.results[v],_=c.receipts[v],w=e.transactions[v],B=w.hash(),S=[];if(1===x.vm.exception)for(var T=0;T<_.logs.length;T++){for(var E=_.logs[T],N=r.hex(E[0]),C=[],O=0;O<E[1].length;O++)C.push(r.hex(E[1][O]));var H=r.hex(E[2]),L=new s({logIndex:r.hex(T),transactionIndex:r.hex(v),transactionHash:B,block:e,address:N,data:H,topics:C,type:"mined"});p.push(L),S.push(L)}let t=new a(w,e,S,x.gasUsed.toArrayLike(Buffer),_.gasUsed,x.createdAddress,_.status,r.hex(_.bitvector));f.push(t);const n=[_.status,_.gasUsed,_.bitvector,_.logs],o=h.rlp.encode(n),i=h.rlp.encode(v);b.push(k(g,i,w.serialize())),b.push(k(m,i,o))}function R(n){if(n)return o(n);o(t,e.transactions,c)}await Promise.all(b),e.header.transactionsTrie=h.toBuffer(g.root),e.header.receiptTrie=h.toBuffer(m.root),n?i.putBlock(e,p,f,R):R()})},v.prototype.processNextBlock=function(t,e){var n=this;"function"==typeof t&&(e=t,t=void 0),n.sortByPriceAndNonce();for(var o=[],i=0,s=r.number(n.blockGasLimit);n.pending_transactions.length>0;){var a=n.pending_transactions[0],c=r.number(a.gasLimit);if(!(i+c<=s))break;i+=c,n.pending_transactions.shift(),o.push(a)}if(0===o.length&&n.pending_transactions.length>0){return e("Unexpected error condition: next transaction exceeds block gas limit")}this.createBlock(function(i,s){if(i)return e(i);t&&(n.data.blocks.last(function(o,i){if(o)return e(o);i&&r.number(i.header.timestamp)>t&&n.logger.log("Waring: Setting the block timestamp ("+t+") that is earlier than the parent block one.")}),s.header.timestamp=r.hex(t),n.setTime(new Date(1e3*t))),Array.prototype.push.apply(s.transactions,o),n.processBlock(n.vm,s,!0,e)})},v.prototype.processTransactionTrace=async function(t,e,n){const o=this,i=r.hex(t);let s,a="",c=null,u={currentDepth:-1,stack:[]},l={gas:0,returnValue:"",structLogs:[]};function h(t,n){const i=r.number(t.gasLeft),a=r.number(c.gasLimit)-i-l.gas;l.gas+=a;let h=null;if(!e.disableMemory&&(h=(h=Buffer.from(t.memory).toString("hex")).match(/.{1,64}/g)||[]).length>0){const t=h[h.length-1];t.length<64&&(h[h.length-1]=t+new Array(64-t.length+1).join("0"))}let p=null;e.disableStack||(p=t.stack.map(t=>r.rpcDataHexString(t,64).replace("0x","")));let f={depth:t.depth,error:"",gas:i,gasCost:a,memory:h,op:t.opcode.name,pc:t.pc,stack:p,storage:null};e.disableStorage?(l.structLogs.push(f),n()):f=o.processStorageTrace(f,u,t,s,function(t,e){if(t)return n(t);l.structLogs.push(e),n()})}this.getTransactionReceipt(i,function(t,e){if(t)return n(t);if(!e)return n(new Error("Unknown transaction "+i));let u=e.block;o.getBlock(u.header.parentHash,function(t,e){if(t)return n(t);var p=o.createStateTrie(o.data.trie_db,e.header.stateRoot);s=o.createVMFromStateTrie(p),o.createBlock(e,function(t,e){if(t)return n(t);for(var p=0;p<u.transactions.length;p++){var f=u.transactions[p];if(e.transactions.push(f),r.hex(f.hash())===i)break}function d(t){c=t,(a=r.hex(t.hash()))===i&&s.on("step",h)}function g(){a===i&&m()}function m(){s.removeListener("step",h),s.removeListener("beforeTx",d),s.removeListener("afterTx",g)}s.on("beforeTx",d),s.on("afterTx",g),o.processBlock(s,e,!1,function(t){t&&0===t.message.indexOf("VM Exception")&&(t=null),m(),n(t,l)})})})})},v.prototype.processStorageTrace=function(t,e,n,o,i){var s,a,c=n.opcode.name,u=n.opcode.in,l=n.stack.slice(-u).map(t=>r.hex(t));switch(e.currentDepth>n.depth&&e.stack.pop(),e.currentDepth<n.depth&&e.stack.push({}),e.currentDepth=n.depth,c){case"SSTORE":s=r.rpcDataHexString(l[1],64).replace("0x",""),a=r.rpcDataHexString(l[0],64).replace("0x",""),t.storage=Object.assign({},e.stack[e.currentDepth]),i(null,t),e.stack[e.currentDepth][s]=a;break;case"SLOAD":s=r.rpcDataHexString(l[0],64).replace("0x",""),o.stateManager.getContractStorage(n.address,"0x"+s,function(n,o){if(n)return i(n);a=r.rpcDataHexString(o,64).replace("0x",""),e.stack[e.currentDepth][s]=a,t.storage=Object.assign({},e.stack[e.currentDepth]),i(null,t)});break;default:t.storage=Object.assign({},e.stack[e.currentDepth]),i(null,t)}},v.prototype.getAccount=function(t,e,n){var r=this;this.getBlock(e,function(e,i){if(e)return n(e);var s=r.stateTrie,a=s.root;r.stateTrie.root=i.header.stateRoot,s.get(h.toBuffer(t),function(t,e){if(s.root=a,t)return n(t);var r=new o(e);n(null,r)})})},v.prototype.getNonce=function(t,e,n){this.getAccount(t,e,function(t,e){if(t)return n(t);n(null,e.nonce)})},v.prototype.getBalance=function(t,e,n){this.getAccount(t,e,function(t,e){if(t)return n(t);n(null,e.balance)})},v.prototype.getStorage=function(t,e,n,r){var i=this;this.getBlock(n,function(n,s){if(n)return r(n);var a=i.stateTrie,c=a.root;i.stateTrie.root=s.header.stateRoot,a.get(h.toBuffer(t),function(t,n){if(null!=t)return a.root=c,r(t);var i=new o(n);a.root=i.stateRoot,a.get(h.setLengthLeft(h.toBuffer(e),32),function(t,e){if(a.root=c,null!=t)return r(t);r(null,e)})})})},v.prototype.getCode=function(t,e,n){var r=this;this.getBlock(e,function(e,i){if(e)return n(e);var s=r.stateTrie,a=s.root;r.stateTrie.root=i.header.stateRoot,s.get(h.toBuffer(t),function(t,e){if(null!=t)return s.root=a,n(t);new o(e).getCode(s,function(t,e){if(s.root=a,t)return n(t);n(null,e)})})})},v.prototype.getTransaction=function(t,e){t=r.hex(t),this.data.transactions.get(t,function(t,n){if(t)return t.notFound?e(null,null):e(t);e(null,n)})},v.prototype.getTransactionReceipt=function(t,e){t=r.hex(t);const n=this.pending_transactions;for(var o=0;o<n.length;o++){if(t===r.hex(n[o].hash()))return e(null,{tx:n[o]})}this.data.transactionReceipts.get(t,function(t,n){if(t)return t.notFound?e(null,null):e(t);e(t,n)})},v.prototype.getBlockLogs=function(t,e){var n=this;this.getEffectiveBlockNumber(t,function(t,r){if(t)return e(t);n.data.blockLogs.get(r,e)})},v.prototype.getHeight=function(t){this.data.blocks.length(function(e,n){if(e)return t(e);t(null,n-1)})},v.prototype.currentTime=function(){return((new Date).getTime()/1e3|0)+this.timeAdjustment},v.prototype.increaseTime=function(t){return t<0&&(t=0),this.timeAdjustment+=t,this.timeAdjustment},v.prototype.setTime=function(t){var e=(new Date).getTime()/1e3|0,n=t.getTime()/1e3|0;this.timeAdjustment=n-e},v.prototype.close=function(t){this.data.close(t)},t.exports=v},function(t,e){t.exports=require("merkle-patricia-tree")},function(t,e){t.exports=require("level-sublevel")},function(t,e,n){var r=n(10);t.exports={encode:function(t,e){e(null,t.encode())},decode:function(t,e){const n={hash:t.hash,nonce:t.nonce,value:t.value,to:t.to,from:t.from,gasLimit:t.gas||t.gasLimit,gasPrice:t.gasPrice,data:t.data,v:t.v,r:t.r,s:t.s},o=void 0===t._type?r.types.fake:t._type;e(null,r.fromJSON(n,o))}}},function(t,e,n){function r(t){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=t}(0,n(1).inherits)(r,Error),t.exports=r},function(t,e,n){var r=n(0);t.exports={toJSON:function(t,e){return{number:r.rpcQuantityHexString(t.header.number),hash:r.hex(t.hash()),parentHash:r.hex(t.header.parentHash),mixHash:r.hex(t.header.mixHash),nonce:r.rpcDataHexString(r.hex(t.header.nonce),16),sha3Uncles:r.hex(t.header.uncleHash),logsBloom:r.hex(t.header.bloom),transactionsRoot:r.hex(t.header.transactionsTrie),stateRoot:r.hex(t.header.stateRoot),receiptsRoot:r.hex(t.header.receiptTrie),miner:r.hex(t.header.coinbase),difficulty:r.rpcQuantityHexString(t.header.difficulty),totalDifficulty:r.rpcQuantityHexString(t.header.difficulty),extraData:r.rpcDataHexString(t.header.extraData),size:r.hex(1e3),gasLimit:r.rpcQuantityHexString(t.header.gasLimit),gasUsed:r.rpcQuantityHexString(t.header.gasUsed),timestamp:r.rpcQuantityHexString(t.header.timestamp),transactions:t.transactions.map(function(n){return e?n.toJsonRpc(t):r.hex(n.hash())}),uncles:[]}}}},function(t,e,n){n(7);const r=n(17),o=n(81);t.exports={server:function(t){return o.create(t)},provider:function(t){return new r(t)},_webpacked:!0}},function(t,e){t.exports=require("web3-provider-engine")},function(t,e){t.exports=require("web3-provider-engine/subproviders/subscriptions")},function(t,e,n){var r=n(4);function o(){this.methods={eth_call:!0,eth_getStorageAt:!0,eth_sendTransaction:!0,eth_sendRawTransaction:!0,eth_newBlockFilter:!0,eth_getFilterChanges:!0,eth_getFilterLogs:!0},this.queue=[],this.isWorking=!1}(0,n(1).inherits)(o,r),t.exports=o,o.prototype.handleRequest=function(t,e,n){if(!0!==t.external||!0!==this.methods[t.method])return e();this.queue.push([t,e]),!1===this.isWorking&&this.processNext()},o.prototype.processNext=function(){var t=this;0!==this.queue.length?(this.isWorking=!0,(0,this.queue.shift()[1])(function(e,n,r){if(e)return r(e);r(),t.processNext()})):this.isWorking=!1}},function(t,e,n){var r=n(4),o=n(1).inherits,i=n(2),s=n(0);function a(){this.watching={}}o(a,r),t.exports=a,a.prototype.handleRequest=function(t,e,n){return"eth_newBlockFilter"===t.method?this.handleNewBlockFilter(t,e,n):"eth_getFilterChanges"===t.method?this.handleGetFilterChanges(t,e,n):void e()},a.prototype.handleNewBlockFilter=function(t,e,n){var r=this;e(function(t,e,n){if(t)return n();r.watching[e]=!0,n()})},a.prototype.handleGetFilterChanges=function(t,e,n){var r=this,o=t.params[0];if(!this.watching[o])return e();e(function(t,e,n){if(t)return n();var a,c,u;i.series([function(t){0!==e.length?(a=e[0],t()):r.emitPayload({method:"eth_blockNumber"},function(e,n){if(e)return t(e);u=s.number(n.result),t()})},function(t){if(u)return t();r.emitPayload({method:"eth_getBlockByHash",params:[a,!1]},function(e,n){if(e)return t(e);u=s.number(n.result.number),t()})},function(t){if(0===(u=s.number(u)))return c=void 0,t();u-=1,r.emitPayload({method:"eth_getBlockByNumber",params:[u,!1]},function(e,n){if(e)return t(e);c=n.result.hash,t()})}],function(t){c&&(e[0]=c),delete r.watching[o],n()})})}},function(t,e,n){var r=n(4);function o(){}(0,n(1).inherits)(o,r),t.exports=o,o.prototype.handleRequest=function(t,e,n){if("eth_estimateGas"!==t.method&&"eth_call"!==t.method)return e();var r=t.params[0];null==r.from?this.emitPayload({method:"eth_coinbase"},function(t,o){if(t)return n(t);var i=o.result;r.from=i,e()}):e()}},function(t,e,n){var r=n(3),o=n(1).inherits,i=n(32),s=n(0),a=n(23),c=n(24),u=n(79);const{BlockOutOfRangeError:l}=n(14);function h(t,e){var n=this;this.state=t.state||new i(t,e),this.options=t,this.initialized=!1,this.initialization_error=null,this.post_initialization_callbacks=[],this.state.initialize(function(t){t&&(n.initialization_error=t),n.initialized=!0;var e=n.post_initialization_callbacks;n.post_initialization_callbacks=[],e.forEach(function(t){setImmediate(function(){t(n.initialization_error,n.state)})})})}o(h,n(4)),h.prototype.waitForInitialization=function(t){!1===this.initialized?this.post_initialization_callbacks.push(t):t(this.initialization_error,this.state)},h.prototype.handleRequest=function(t,e,n){if(null!=this.initialization_error)return n(this.initialization_error);if(!1!==this.initialized){var r=this[t.method];if(null==r)return n(new Error("Method "+t.method+" not supported."));var o=t.params||[],i=[].concat(o),s=!1;if(this.requiresDefaultBlockParameter(t.method)&&i.length<r.length-1&&(i.push("latest"),s=!0),i.push(n),i.length>r.length||void 0!==r.minLength&&i.length<r.minLength||void 0===r.minLength&&i.length<r.length){var a=`Incorrect number of arguments. Method '${t.method}' requires `;return r.minLength?a+=`between ${r.minLength-1} and ${r.length-1} arguments. `:a+=`exactly ${r.length-1} arguments. `,a+=s?"Including the implicit block argument, r":"R",a+=`equest specified ${i.length-1} arguments: ${JSON.stringify(i)}.`,n(new Error(a))}r.apply(this,i)}else this.waitForInitialization(this.getDelayedHandler(t,e,n))},h.prototype.getDelayedHandler=function(t,e,n){var r=this;return function(o,i){o&&n(o),r.handleRequest(t,e,n)}},h.prototype.requiresDefaultBlockParameter=function(t){return!0==={eth_getBalance:!0,eth_getCode:!0,eth_getTransactionCount:!0,eth_getStorageAt:!0,eth_call:!0,eth_estimateGas:!0}[t]},h.prototype.eth_accounts=function(t){t(null,Object.keys(this.state.accounts))},h.prototype.eth_blockNumber=function(t){this.state.blockNumber(function(e,n){if(e)return t(e);t(null,s.hex(n))})},h.prototype.eth_coinbase=function(t){t(null,this.state.coinbase)},h.prototype.eth_mining=function(t){t(null,this.state.is_mining)},h.prototype.eth_hashrate=function(t){t(null,"0x0")},h.prototype.eth_gasPrice=function(t){t(null,r.addHexPrefix(this.state.gasPrice()))},h.prototype.eth_getBalance=function(t,e,n){this.state.getBalance(t,e,n)},h.prototype.eth_getCode=function(t,e,n){this.state.getCode(t,e,n)},h.prototype.eth_getBlockByNumber=function(t,e,n){this.state.blockchain.getBlock(t,function(t,r){if(t)return t instanceof l?n(null,null):n(t);n(null,c.toJSON(r,e))})},h.prototype.eth_getBlockByHash=function(t,e,n){this.eth_getBlockByNumber.apply(this,arguments)},h.prototype.eth_getBlockTransactionCountByNumber=function(t,e){this.state.blockchain.getBlock(t,function(t,n){if(t)return t instanceof l?e(null,null):e(t);e(null,n.transactions.length)})},h.prototype.eth_getBlockTransactionCountByHash=function(t,e){this.eth_getBlockTransactionCountByNumber.apply(this,arguments)},h.prototype.eth_getTransactionReceipt=function(t,e){this.state.getTransactionReceipt(t,function(t,n){if(t)return e(t);var r=null;n&&n.block&&(r=n.toJSON()),e(null,r)})},h.prototype.eth_getTransactionByHash=function(t,e){this.state.getTransactionReceipt(t,function(t,n){if(t)return e(t);var r=null;n&&(n.block?r=n.tx.toJsonRpc(n.block):(n.block={transactions:[],hash:()=>null,header:{number:null}},r=n.tx.toJsonRpc(n.block))),e(null,r)})},h.prototype.eth_getTransactionByBlockHashAndIndex=function(t,e,n){e=s.number(e),this.state.getBlock(t,function(t,r){if(t)return t.notFound?n(null,null):n(t);if(e>=r.transactions.length)return n(new Error("Transaction at index "+s.hex(e)+" does not exist in block."));var o=r.transactions[e].toJsonRpc(r);n(null,o)})},h.prototype.eth_getTransactionByBlockNumberAndIndex=function(t,e,n){this.eth_getTransactionByBlockHashAndIndex(t,e,n)},h.prototype.eth_getTransactionCount=function(t,e,n){this.state.getTransactionCount(t,e,(t,e)=>t instanceof l?n(null,null):n(t,e))},h.prototype.eth_sign=function(t,e,n){var r,o;try{r=this.state.sign(t,e)}catch(t){o=t}n(o,r)},h.prototype.eth_signTypedData=function(t,e,n){var r,o;try{r=this.state.signTypedData(t,e)}catch(t){o=t}n(o,r)},h.prototype.eth_sendTransaction=function(t,e){this.state.queueTransaction("eth_sendTransaction",t,null,e)},h.prototype.eth_sendRawTransaction=function(t,e){let n;if(t&&(n=s.buffer(t)),void 0===n)throw new a("rawTx must be a string, JSON-encoded Buffer, or Buffer.");this.state.queueRawTransaction(n,e)},h.prototype.eth_call=function(t,e,n){t.gas||(t.gas=this.state.blockchain.blockGasLimit),this.state.queueTransaction("eth_call",t,e,n)},h.prototype.eth_estimateGas=function(t,e,n){t.gas||(t.gas=this.state.blockchain.blockGasLimit),this.state.queueTransaction("eth_estimateGas",t,e,n)},h.prototype.eth_getStorageAt=function(t,e,n,r){this.state.queueStorage(t,e,n,r)},h.prototype.eth_newBlockFilter=function(t){var e=r.addHexPrefix(r.intToHex(this.state.latestFilterId));this.state.latestFilterId+=1,t(null,e)},h.prototype.eth_getFilterChanges=function(t,e){var n=this.state.latestBlock().hash().toString("hex");this.state.mine(),e(null,[n])},h.prototype.eth_getLogs=function(t,e){this.state.getLogs(t,e)},h.prototype.eth_uninstallFilter=function(t,e){e(null,!0)},h.prototype.eth_protocolVersion=function(t){t(null,"63")},h.prototype.bzz_hive=function(t){t(null,[])},h.prototype.bzz_info=function(t){t(null,[])},h.prototype.shh_version=function(t){t(null,"2")},h.prototype.eth_getCompilers=function(t){t(null,[])},h.prototype.eth_syncing=function(t){t(null,!1)},h.prototype.net_listening=function(t){t(null,!0)},h.prototype.net_peerCount=function(t){t(null,0)},h.prototype.web3_clientVersion=function(t){t(null,"EthereumJS TestRPC/v"+u.version+"/ethereum-js")},h.prototype.web3_sha3=function(t,e){e(null,s.hex(r.sha3(t)))},h.prototype.net_version=function(t){t(null,this.state.net_version+"")},h.prototype.miner_start=function(t,e){e||"function"!=typeof t||(e=t,t=null),this.state.startMining(function(t){e(t,!0)})},h.prototype.miner_start.minLength=1,h.prototype.miner_stop=function(t){this.state.stopMining(function(e){t(e,!0)})},h.prototype.rpc_modules=function(t){t(null,{eth:"1.0",net:"1.0",rpc:"1.0",web3:"1.0",evm:"1.0",personal:"1.0"})},h.prototype.personal_listAccounts=function(t){t(null,Object.keys(this.state.personal_accounts))},h.prototype.personal_newAccount=function(t,e){var n=this.state.createAccount({generate:!0});this.state.accounts[n.address.toLowerCase()]=n,this.state.personal_accounts[n.address.toLowerCase()]=!0,this.state.account_passwords[n.address.toLowerCase()]=t,e(null,n.address)},h.prototype.personal_importRawKey=function(t,e,n){var r=this.state.createAccount({secretKey:t});this.state.accounts[r.address.toLowerCase()]=r,this.state.personal_accounts[r.address.toLowerCase()]=!0,this.state.account_passwords[r.address.toLowerCase()]=e,n(null,r.address)},h.prototype.personal_lockAccount=function(t,e){if(!0!==this.state.personal_accounts[t.toLowerCase()]){return e("Account not found")}delete this.state.unlocked_accounts[t.toLowerCase()],e(null,!0)},h.prototype.personal_unlockAccount=function(t,e,n,r){if(!0!==this.state.personal_accounts[t.toLowerCase()]){return r("Account not found")}var o=this.state.account_passwords[t.toLowerCase()];if(void 0!==o&&o!==e){return r("Invalid password")}this.state.unlocked_accounts[t.toLowerCase()]=!0,r(null,!0)},h.prototype.personal_sendTransaction=function(t,e,n){if(null!=t.from){var o=r.addHexPrefix(t.from).toLowerCase(),i=this;i.personal_unlockAccount(o,e,null,function(e){if(e)return n(e);i.state.queueTransaction("eth_sendTransaction",t,null,function(t,e){i.state.unlocked_accounts[o.toLowerCase()]=!1,n(t,e)})})}else{n("Sender not found")}},h.prototype.evm_snapshot=function(t){this.state.snapshot(t)},h.prototype.evm_revert=function(t,e){this.state.revert(t,e)},h.prototype.evm_increaseTime=function(t,e){e(null,this.state.blockchain.increaseTime(t))},h.prototype.evm_setTime=function(t,e){e(null,this.state.blockchain.setTime(t))},h.prototype.evm_mine=function(t,e){"function"==typeof t&&(e=t,t=void 0),this.state.processBlock(t,function(t){if(t)return e(t);e(t,"0x0")})},h.prototype.evm_mine.minLength=1,h.prototype.debug_traceTransaction=function(t,e,n){"function"==typeof e&&(n=e,e=[]),this.state.queueTransactionTrace(t,e,n)},h.prototype.eth_getUncleCountByBlockHash=function(t,e){e(null,"0x0")},h.prototype.eth_getUncleCountByBlockNumber=function(t,e){e(null,"0x0")},h.prototype.eth_getUncleByBlockHashAndIndex=function(t,e,n){n(null,{})},h.prototype.eth_getUncleByBlockNumberAndIndex=function(t,e,n){n(null,{})},h.prototype.eth_getWork=function(t,e){e(null,[])},h.prototype.eth_submitWork=function(t,e,n,r){r(null,!1)},h.prototype.eth_submitHashrate=function(t,e,n){n(null,!1)},h.prototype.db_putString=function(t,e,n,r){r(null,!1)},h.prototype.db_getString=function(t,e,n){n(null,"")},h.prototype.db_putHex=function(t,e,n,r){r(null,!1)},h.prototype.db_getHex=function(t,e,n){n(null,"0x00")},h.prototype.shh_post=function(t,e,n,r,o,i,s){s(null,!1)},h.prototype.shh_newIdentity=function(t){t(null,"0x00")},h.prototype.shh_hasIdentity=function(t,e){e(null,!1)},h.prototype.shh_newGroup=function(t){t(null,"0x00")},h.prototype.shh_addToGroup=function(t,e){e(null,!1)},h.prototype.shh_newFilter=function(t,e,n){n(null,!1)},h.prototype.shh_uninstallFilter=function(t,e){e(null,!1)},h.prototype.shh_getFilterChanges=function(t,e){e(null,[])},h.prototype.shh_getMessages=function(t,e){e(null,!1)},t.exports=h},function(t,e,n){var r=n(8),o=n(9),i=n(10),s=n(3),a=n(38),c=n(39),u=n(18),l=n(45),h=n(2),p=n(19),f=n(65),d=n(16),g=n(77),m=n(6);const{BlockOutOfRangeError:b}=n(14),y=n(5),k=Buffer.from([0]);var v=n(0),x=n(78),_=n(23);function w(t,e){this.options=t=this._applyDefaultOptions(t||{}),t.fork?this.blockchain=new f(t):this.blockchain=new p(t),this.vm=this.blockchain.vm,this.stateTrie=this.blockchain.stateTrie,this.accounts={},this.secure=!!t.secure,this.account_passwords={},this.personal_accounts={},this.total_accounts=t.total_accounts,this.coinbase=null,this.latest_filter_id=1,this.action_queue=[],this.action_processing=!1,this.snapshots=[],this.logger=t.logger,this.net_version=t.network_id,this.mnemonic=t.mnemonic,this.wallet=l.fromMasterSeed(c.mnemonicToSeed(this.mnemonic)),this.wallet_hdpath=t.hdPath,this.gasPriceVal=v.rpcQuantityHexString(t.gasPrice),this.is_mining=!0,this.blockTime=t.blockTime,this.is_mining_on_interval=!!t.blockTime,this.mining_interval_timeout=null,this._provider=e}const B={total_accounts:10,gasPrice:"0x77359400",default_balance_ether:100,unlocked_accounts:[],hdPath:"m/44'/60'/0'/0/"};w.prototype._applyDefaultOptions=function(t){if(t.seed||(t.seed=x.randomAlphaNumericString(10,a())),!t.mnemonic){let e=x.randomBytes(16,a(t.seed));t.mnemonic=c.entropyToMnemonic(e.toString("hex"))}return t.fork||t.network_id||(t.network_id=(new Date).getTime()),m.merge(t,B,Object.assign({},t))},w.prototype.initialize=function(t){var e=this,n=[];let r=v.hex(d.utils.toWei(e.options.default_balance_ether.toString(),"ether"));if(e.options.accounts)n=e.options.accounts.map(e.createAccount.bind(e));else{if(!e.total_accounts)return t(new Error("Cannot initialize chain: either options.accounts or options.total_accounts must be specified"));for(var o=0;o<e.total_accounts;o++)n.push(e.createAccount({index:o,balance:r}))}e.coinbase=v.hex(n[0].address),e.accounts={},n.forEach(function(t){e.accounts[t.address]=t,e.personal_accounts[t.address.toLowerCase()]=!0}),e.unlocked_accounts=e.options.unlocked_accounts.reduce(function(t,e){if(0!==(e+"").indexOf("0x")){let t=parseInt(e),r=n[t];if(!r)throw new Error(`Account at index ${t} not found. Max index available is ${n.length-1}.`);e=r.address.toLowerCase()}return t[e.toLowerCase()]=!0,t},{}),e.secure||n.forEach(function(t){e.unlocked_accounts[t.address.toLowerCase()]=t}),e.blockchain.initialize(n,function(n){if(n)return t(n);e.net_version||(e.net_version=e.blockchain.forkVersion),e.is_mining_on_interval&&e.mineOnInterval(),t()})},w.prototype._minerCancellationToken=null,w.prototype.mineOnInterval=function(){if(clearTimeout(this.mining_interval_timeout),null!==this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0),!this.is_mining)return void this.logger.log("Warning: mineOnInterval called when miner was stopped");const t={cancelled:!1};this._minerCancellationToken=t;const e=this.mining_interval_timeout=setTimeout(this._provider.send.bind(this._provider),1e3*this.blockTime,{method:"evm_mine"},()=>{t.cancelled||this.mineOnInterval.bind(this)()});"function"==typeof e.unref&&e.unref()},w.prototype.createAccount=function(t,e){var n;if(t.generate)n=u.generate().getPrivateKey();else if(t.secretKey)n=s.toBuffer(v.hex(t.secretKey));else{var o=void 0===t.index?e:t.index;n=this.wallet.derivePath(this.wallet_hdpath+o).getWallet().getPrivateKey()}var i=s.privateToPublic(n),a=s.publicToAddress(i),c=new r;return c.balance=v.hex(t.balance),{secretKey:n,publicKey:i,address:v.hex(a).toLowerCase(),account:c}},w.prototype.blockNumber=function(t){return this.blockchain.getHeight(t)},w.prototype.gasPrice=function(){return this.gasPriceVal},w.prototype.getBalance=function(t,e,n){this.blockchain.getBalance(t,e,function(t,e){e&&(e=v.rpcQuantityHexString(e)),n(t,e)})},w.prototype.getTransactionCount=function(t,e,n){this.blockchain.getNonce(t,e,function(t,e){e&&(e=v.rpcQuantityHexString(e)),n(t,e)})},w.prototype.getCode=function(t,e,n){this.blockchain.getCode(t,e,function(t,e){e&&(e=v.hex(e)),n(t,e)})},w.prototype.queueRawTransaction=function(t,e){const n=new i(t,i.types.signed),r=v.hex(n.from).toLowerCase();this._queueTransaction("eth_sendRawTransaction",n,r,null,e)},w.prototype.queueStorage=function(t,e,n,r){this.action_queue.push({method:"eth_getStorageAt",address:s.addHexPrefix(t),position:s.addHexPrefix(e),block:n,callback:r}),this.processNextAction()},w.prototype.queueTransaction=function(t,e,n,r){const o=e.from?v.hex(e.from).toLowerCase():null;if(null==o)return void r(new _("from not found; is required"));if(e.to&&"string"!=typeof e.to)return r(new _("Invalid to address"));const s=this.accounts.hasOwnProperty(o);if("eth_sendTransaction"===t&&!this.unlocked_accounts.hasOwnProperty(o)){return r(new _(s?"signer account is locked":"sender account not recognized"))}let a,c=i.types.none;s&&"eth_call"!==t||(c|=i.types.fake);try{a=i.fromJSON(e,c),this._setTransactionDefaults(a)}catch(t){return void r(t)}this._queueTransaction(t,a,o,n,r)},w.prototype._setTransactionDefaults=function(t){0===t.gasLimit.length&&(t.gasLimit=s.toBuffer(this.blockchain.defaultTransactionGasLimit)),0===t.gasPrice.length&&(t.gasPrice=s.toBuffer(this.gasPriceVal)),0===t.value.length&&(t.value=Buffer.from([0])),(0===t.to.length||t.to.equals(k))&&(t.to=Buffer.allocUnsafe(0))},w.prototype._queueTransaction=function(t,e,n,r,o){if(!(e instanceof i))throw new _("tx must be of type Transaction");if(v.number(e.gasLimit)>v.number(this.blockchain.blockGasLimit))return o(new _("Exceeds block gas limit"));this.action_queue.push({method:t,from:n,tx:e,callback:o,blockNumber:r}),this.processNextAction()},w.prototype.queueTransactionTrace=function(t,e,n){this.action_queue.push({method:"debug_traceTransaction",hash:v.hex(t),params:e,callback:n}),this.processNextAction()},w.prototype.processNextAction=function(t){var e=this;if(!0===t||!0!==this.action_processing&&0!==this.action_queue.length){var n=this.action_queue.shift();this.action_processing=!0;var r=function(t,r){n.callback(t,r),e.action_queue.length>0?e.processNextAction(!0):e.action_processing=!1};if("function"==typeof n.method){var o=n.method();return r(null,o)}"eth_getStorageAt"===n.method?this.blockchain.getStorage(n.address,n.position,n.block,function(t,e){if(t)return r(t);e&&(e=s.rlp.decode(e)),e=v.hex(e||0),r(null,e)}):"debug_traceTransaction"===n.method?this.blockchain.processTransactionTrace(n.hash,n.params,r):"eth_sendTransaction"===n.method||"eth_sendRawTransaction"===n.method?this.processTransaction(n.from,n.tx,r):"eth_call"===n.method?this.processCall(n.from,n.tx,n.blockNumber,r):"eth_estimateGas"===n.method&&this.processGasEstimate(n.from,n.tx,n.blockNumber,r)}},w.prototype.sign=function(t,e){var n=this.accounts[v.hex(t).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");var r=n.secretKey,o=v.buffer(e,"hex"),i=s.hashPersonalMessage(o),a=s.ecsign(i,Buffer.from(r));return s.toRpcSig(a.v,a.r,a.s)},w.prototype.signTypedData=function(t,e){var n=this.accounts[v.hex(t).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");if(!e.types)throw new Error("cannot sign data; types missing");if(!e.types.EIP712Domain)throw new Error("cannot sign data; EIP712Domain definition missing");if(!e.domain)throw new Error("cannot sign data; domain missing");if(!e.primaryType)throw new Error("cannot sign data; primaryType missing");if(!e.message)throw new Error("cannot sign data; message missing");return g.signTypedData(n.secretKey,{data:e})},w.prototype.printTransactionReceipt=function(t,e,n){var r=this;r.blockchain.getTransactionReceipt(t,function(o,i){if(o)return n(o);r.blockchain.latestBlock(function(o,s){if(o)return n(o);i=i.toJSON(),r.logger.log(""),r.logger.log("  Transaction: "+t),null!=i.contractAddress&&r.logger.log("  Contract created: "+i.contractAddress),r.logger.log("  Gas usage: "+parseInt(i.gasUsed,16)),r.logger.log("  Block Number: "+parseInt(i.blockNumber,16)),r.logger.log("  Block Time: "+new Date(1e3*v.number(s.header.timestamp)).toString()),e&&(r.logger.log("  Runtime Error: "+e.error),e.reason&&r.logger.log("  Revert reason: "+e.reason)),r.logger.log(""),n(null,t)})})},w.prototype.processBlock=function(t,e){var n=this;"function"==typeof t&&(e=t,t=null),n.blockchain.processNextBlock(t,function(t,r,i){if(t&&t instanceof o==!1)return e(t,r,i);h.eachSeries(r,function(e,r){var o=v.hex(e.hash()),i=null==t?{results:{}}:t;n.printTransactionReceipt(o,i.results[o],r)},e(t,r,i))})},w.prototype.processBlocks=function(t,e){var n=this;"function"==typeof t&&(e=t,t=null);var r=null,i=0;h.whilst(function(){return null==t?n.blockchain.pending_transactions.length>0:i<t},function(t){n.processBlock(function(e,n,s){if(i+=1,e){if(e instanceof o==!1)return t(e);null==r?r=e:r.combine(e)}t()})},function(t){e(t||r)})},w.prototype.processCall=function(t,e,n,r){var o=this;o.createTransactionWithCorrectNonce(e,t,function(t,e){if(t)return r(t);o.blockchain.processCall(e,n,function(t,e){if(t)return t instanceof b?r(null,null):r(t);var n="0x";return!e.error&&e.vm.return?n=v.hex(e.vm.return):e.error&&o.logger.log(`Error processing call: ${e.error}`),r(null,n)})})},w.prototype.processGasEstimate=function(t,e,n,r){var o=this;o.createTransactionWithCorrectNonce(e,t,function(t,e){if(t)return r(t);o.blockchain.estimateGas(e,n,function(t,e){if(t)return r(t);var n="0x";return e.error?o.logger.log(`Error calculating gas estimate: ${e.error}`):n=e.gasRefund?v.hex(e.gasEstimate.add(e.gasRefund)):v.hex(e.gasEstimate),r(null,n)})})},w.prototype.processTransaction=function(t,e,n){var r=this;r.createTransactionWithCorrectNonce(e,t,function(t,e){if(t)return n(t);r.blockchain.queueTransaction(e);var o=v.hex(e.hash());if(!1===r.is_mining||r.is_mining_on_interval)return n(null,o);r.processBlocks(function(t){if(t)return n(t);n(null,o)})})},w.prototype.getTransactionReceipt=function(t,e){this.blockchain.getTransactionReceipt(t,function(t,n){if(t&&t.notFound)return e(null,null);e(t,n)})},w.prototype.getBlock=function(t,e){this.blockchain.getBlock(t,e)},w.prototype.getLogs=function(t,e){var n=this,r=t.address&&(Array.isArray(t.address)?t.address:[t.address]);r=r&&r.map(function(t){return t.toLowerCase()});var o=t.topics||[];h.parallel({fromBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,t.fromBlock||"latest"),toBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,t.toBlock||"latest"),latestBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,"latest")},function(t,i){if(t)return e(t);var s=i.fromBlock,a=i.toBlock,c=i.latestBlock;a>c&&(a=c);var u=[],l=s;h.whilst(function(){return l<=a},function(t){n.blockchain.getBlockLogs(l,function(e,n){if(e)return t(e);var i=r?n.filter(function(t){return r.indexOf(t.address.toLowerCase())>-1}):n;i=i.filter(function(t){for(var e=!0,n=0;n<o.length;n++){var r=o[n],i=t.topics[n];if(null!=r){var s=Array.isArray(r)?r.includes(i):r===i;if(n>=t.topics.length||!s){e=!1;break}}}return e}),u.push.apply(u,i),l+=1,t()})},function(t){if(t)return e(t);u=u.map(function(t){return t.toJSON()}),e(t,u)})})},w.prototype.snapshot=function(t){var e=this;this.blockchain.getHeight(function(n,r){if(n)return t(n);e.snapshots.push({blockNumber:r,timeAdjustment:e.blockchain.timeAdjustment}),e.logger.log("Saved snapshot #"+e.snapshots.length),t(null,v.hex(e.snapshots.length))})},w.prototype.revert=function(t,e){var n=this;if(t=s.bufferToInt(t),this.logger.log("Reverting to snapshot #"+t),t>this.snapshots.length)return e(null,!1),!1;t-=1;var r=this.snapshots[t].timeAdjustment;h.whilst(function(){return n.snapshots.length>t},function(t){var e=n.snapshots.pop();h.during(function(t){n.blockchain.getHeight(function(n,r){if(n)return t(n);t(null,r>e.blockNumber)})},function(t){n.blockchain.popBlock(function(e){if(e)return t(e);t()})},t)},function(t){if(t)return e(t);n.blockchain.clearPendingTransactions(),n.blockchain.timeAdjustment=r,e(null,!0)})},w.prototype.hasContractCode=function(t,e){this.vm.stateManager.getContractCode(t,function(t,n){null!=t?e(t,!1):e(null,!0)})},w.prototype.startMining=function(t){if(this.is_mining)return process.nextTick(t),void this.logger.log("Warning: startMining called when miner was already started");this.is_mining=!0,this.is_mining_on_interval?(this.mineOnInterval(),process.nextTick(t)):this.processBlocks(t)},w.prototype.stopMining=function(t){this.is_mining?(this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0,this._minerCancellationToken=null),this.is_mining=!1,clearTimeout(this.mining_interval_timeout),this.mining_interval_timeout=null):this.logger.log("Warning: stopMining called when miner was already stopped"),t&&process.nextTick(t)},w.prototype.isUnlocked=function(t){return null!=this.unlocked_accounts[t.toLowerCase()]},w.prototype.createTransactionWithCorrectNonce=function(t,e,n){this.blockchain.getQueuedNonce(e,(r,o)=>{if(r)return n(r);const i=(t,e)=>{if(t.validateNonce(e))return Promise.resolve(t);{const n=new y(e).toString(10),r=new y(t.nonce).toString(10);return Promise.reject(new _(`the tx doesn't have the correct nonce. account has nonce of: ${n} tx has nonce of: ${r}`))}},s=t=>n(null,t);if(t.isSigned())i(t,o).then(s).catch(n);else{const r=t=>{if(!t.isFake()&&!t.isSigned()){const n=this.accounts[e];n&&t.sign(n.secretKey)}return Promise.resolve(t)};0===t.nonce.length?(t.nonce=o,r(t).then(s)):i(t,o).then(r).then(s).catch(n)}})},t.exports=w},function(t,e){t.exports=require("ethereumjs-abi")},function(t,e){t.exports=require("ethereumjs-tx")},function(t,e){t.exports=require("ethereumjs-tx/fake")},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("rlp")},function(t,e){t.exports=require("seedrandom")},function(t,e){t.exports=require("bip39")},function(t,e){t.exports=require("safe-buffer")},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("scrypt.js")},function(t,e){t.exports=require("uuid/v4")},function(t,e){t.exports=require("bs58check")},function(t,e,n){"use strict";var r=n(46),o=n(18);function i(){}function s(t){var e=new i;return e._hdkey=t,e}i.fromMasterSeed=function(t){return s(r.fromMasterSeed(t))},i.fromExtendedKey=function(t){return s(r.fromExtendedKey(t))},i.prototype.privateExtendedKey=function(){if(!this._hdkey.privateExtendedKey)throw new Error("This is a public key only wallet");return this._hdkey.privateExtendedKey},i.prototype.publicExtendedKey=function(){return this._hdkey.publicExtendedKey},i.prototype.derivePath=function(t){return s(this._hdkey.derive(t))},i.prototype.deriveChild=function(t){return s(this._hdkey.deriveChild(t))},i.prototype.getWallet=function(){return this._hdkey._privateKey?o.fromPrivateKey(this._hdkey._privateKey):o.fromPublicKey(this._hdkey._publicKey,!0)},t.exports=i},function(t,e){t.exports=require("hdkey")},function(t,e){t.exports=require("ethereumjs-vm")},function(t,e){t.exports=require("heap")},function(t,e,n){var r=n(50),o=n(51),i=n(52),s=n(53),a=n(54),c=n(58),u=n(22),l=n(59),h=n(60),p=n(61),f=n(62),d=n(63);function g(t){this.options=t,this.directory=null}g.prototype.initialize=function(t){var e=this;function n(n,i){if(n)return t(n);e.db=i,e.blocks=new r("blocks",e.db,l),e.blockLogs=new r("blockLogs",e.db,new p(e)),e.blockHashes=new o("blockHashes",e.db),e.transactions=new o("transactions",e.db,u),e.transactionReceipts=new o("transactionReceipts",e.db,new f(e)),e.trie_db=new o("trie_db",e.db,h,h),t()}!function(t){e.options.db_path?t(null,e.options.db_path):d.dir(t)}(function(r,o){if(r)return t(r);const u={valueEncoding:"json"};if(e.options.db){const t=e.options.db;i(t,u,n)}else{e.directory=o;const t=s(c(o,a).maxSize(100),u);i(t,{},n)}})},g.prototype.close=function(t){t()},t.exports=g},function(t,e,n){var r=n(21);const{LevelUpOutOfRangeError:o,BlockOutOfRangeError:i}=n(14);function s(t,e,n){this.db=r(e),this.db=this.db.sublevel(t),this.name=t,this.serializer=n||{encode:function(t,e){e(null,t)},decode:function(t,e){e(null,t)}}}s.prototype.length=function(t){this.db.get("length",function(e,n){if(e)return e.notFound?t(null,0):t(e);t(null,n)})},s.prototype._get=function(t,e){var n=this;this.db.get(t,function(t,r){if(t)return e(t);n.serializer.decode(r,e)})},s.prototype._put=function(t,e,n){var r=this;this.serializer.encode(e,function(e,o){if(e)return n(e);r.db.put(t,o,n)})},s.prototype.get=function(t,e){var n=this;this.length(function(r,s){if(r)return e(r);if(t>=s){let r="blocks"===n.name?new i(t,s):new o(n.name,t,s);return e(r)}n._get(t,e)})},s.prototype.push=function(t,e){var n=this;this.length(function(r,o){if(r)return e(r);n._put(o+"",t,function(t){if(t)return e(t);n.db.put("length",o+1,e)})})},s.prototype.pop=function(t){var e=this;this.length(function(n,r){if(n)return t(n);var o=r-1;e._get(o+"",function(n,r){if(n)return t(n);e.db.del(o+"",function(n){if(n)return t(n);e.db.put("length",o,function(e){if(e)return t(e);t(null,r)})})})})},s.prototype.last=function(t){var e=this;this.length(function(n,r){return n?t(n):0===r?t(null,null):void e._get(r-1+"",t)})},s.prototype.first=function(t){this._get("0",t)},t.exports=s},function(t,e,n){var r=n(21),o=n(2);function i(t,e,n,o,i){this.db=r(e,i),this.db=this.db.sublevel(t),this.name=t,this.valueserializer=n||{encode:function(t,e){e(null,t)},decode:function(t,e){e(null,t)}},this.keyserializer=o||{encode:function(t,e){e(null,t)},decode:function(t,e){e(null,t)}}}i.prototype.get=function(t,e,n){var r=this;"function"==typeof e&&(n=e,e={}),this.keyserializer.encode(t,function(t,e){if(t)return n(t);r.db.get(e,function(t,e){if(t)return n(t);r.valueserializer.decode(e,function(t,e){if(t)return n(t);n(null,e)})})})},i.prototype.put=function(t,e,n,r){var o=this;"function"==typeof n&&(r=n,n={}),this.keyserializer.encode(t,function(t,n){if(t)return r(t);o.valueserializer.encode(e,function(t,e){if(t)return r(t);o.db.put(n,e,r)})})},i.prototype.set=i.prototype.put,i.prototype.del=function(t,e){var n=this;this.keyserializer.encode(t,function(t,r){if(t)return e(t);n.db.del(r,e)})},i.prototype.batch=function(t,e,n){var r=this;o.each(t,function(t,n){"put"===t.type?r.put(t.key,t.value,e,n):"del"===t.type?r.del(t.key,n):n(new Error("Unknown batch type",t.type))},function(t){if(t)return n(t);n()})},i.prototype.isOpen=function(){return!0},t.exports=i},function(t,e){t.exports=require("levelup")},function(t,e){t.exports=require("encoding-down")},function(t,e,n){var r=n(1),o=n(55).AbstractLevelDOWN,i=n(2),s=n(56),a=n(57);function c(t){this.location=t,o.call(this,t)}r.inherits(c,o),c.prototype._open=function(t,e){e(null,this)},c.prototype._put=function(t,e,n,r){s.writeFile(a.join(this.location,t),e,"utf8",r)},c.prototype._get=function(t,e,n){s.readFile(a.join(this.location,t),"utf8",function(t,e){if(t)return n(new Error("NotFound"));n(null,e)})},c.prototype._del=function(t,e,n){s.unlink(a.join(this.location,t),function(t){if(t)return t.message.indexOf("ENOENT")>=0?n():n(t);n()})},c.prototype._batch=function(t,e,n){var r=this;i.each(t,function(t,n){"put"===t.type?r.put(t.key,t.value,e,n):"del"===t.type?r.del(t.key,e,n):n(new Error("Unknown batch type",t.type))},function(t){if(t)return n(t);n()})},t.exports=function(t){return new c(t)}},function(t,e){t.exports=require("abstract-leveldown")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("cachedown")},function(t,e,n){var r=n(22),o=n(2),i=n(11);t.exports={encode:function(t,e){var n=t.toJSON(!0);o.map(t.transactions,function(t,e){r.encode(t,e)},function(t,r){if(t)return e(t);n.transactions=r,e(null,n)})},decode:function(t,e){var n=t.transactions;t.transactions=[];var s=new i(t);o.eachSeries(n,function(t,e){r.decode(t,function(t,n){if(t)return e(t);s.transactions.push(n),e()})},function(t){if(t)return e(t);e(null,s)})}}},function(t,e,n){var r=n(3),o=n(0);t.exports={encode:function(t,e){e(null,o.hex(t))},decode:function(t,e){e(null,r.toBuffer(t))}}},function(t,e,n){var r=n(12),o=n(2);function i(t){this.database=t}i.prototype.encode=function(t,e){e(null,t=t.map(function(t){return t.toJSON()}))},i.prototype.decode=function(t,e){var n=this;if(0===t.length)return e(null,[]);this.database.blockHashes.get(t[0].blockHash,function(i,s){if(i)return e(i);n.database.blocks.get(s,function(n,i){if(n)return e(n);o.map(t,function(t,e){e(null,new r({block:i,logIndex:t.logIndex,transactionIndex:t.transactionIndex,transactionHash:t.transactionHash,address:t.address,data:t.data,topics:t.topics,type:t.type}))},function(t,n){if(t)return e(t);e(null,n)})})})},t.exports=i},function(t,e,n){var r=n(13),o=n(2);function i(t){this.database=t}i.prototype.encode=function(t,e){e(null,t.toJSON())},i.prototype.decode=function(t,e){var n=this,i=t.transactionHash.toLowerCase();this.database.transactions.get(t.transactionHash,function(s,a){if(s)return e(s);n.database.blockHashes.get(t.blockHash,function(s,c){if(s)return e(s);o.parallel({block:n.database.blocks.get.bind(n.database.blocks,c),logs:n.database.blockLogs.get.bind(n.database.blockLogs,c)},function(n,o){if(n)return e(n);e(null,new r(a,o.block,o.logs.filter(t=>t.transactionHash.toLowerCase()===i),t.gasUsed,t.cumulativeGasUsed,t.contractAddress,t.status,t.logsBloom))})})})},t.exports=i},function(t,e){t.exports=require("tmp")},function(t,e,n){const r=n(5);t.exports=((t,e,n,i)=>{const s=o();t.on("step",s.collect),t.runTx(e,function(t,o){const a=s.ops.length;if(t)return t instanceof Error==!1&&(t=new Error("VM error: "+t)),i(t,n);if(s.success()&&a&&a-1!==s.lowestGasIndex()){const t=(null!=e.tx.data?Array.from(e.tx.data):[]).reduce((t,e)=>t+(0===e?4:68),21e3),n=h(0,s.ops.length-1,s.sysOpIndex())+t;o.gasEstimate=new r(n)}else{let t=o.gasUsed;if(a){const e=s.lastSVT();if(s.success()&&e>0){const n=s.ops[e].gasLeft.sub(s.ops[s.ops.length-1].gasLeft),o=new r(2300);t=t.add(new r(n.lt(o)?o.sub(n):0))}}o.gasEstimate=t}i(t,o)});const a=(t,e)=>{const n=s.lastSVT();if(n>t&&n<e){const r=s.ops[t].gasLeft-s.ops[n].gasLeft;let o;if(s.ops[n].depth){const t=s.ops[n].gasLeft-s.ops[e-1].gasLeft;o=t<2300?2300-t:t}else{const t=s.ops[n].gasLeft-s.ops[e].gasLeft;o=t<2300?2300:t}return r+o}return s.ops[t].gasLeft-s.ops[e].gasLeft},c=t=>{let e=s.ops[t].depth;const n=s.findIndex(t);let r=n,o=n;const i=s.systemOps.length;for(;o<i&&s.systemOps[o][1]>=e;)++o;for(;r&&s.systemOps[r][1]>=e;)--r;return{parentBegin:s.systemOps[r][0],parentEnd:s.systemOps[o-1][0]+1}},u=t=>parseInt(`0x${t.gasLeft.toString("hex")}`),l=t=>2300===t.gasLeft,h=(t,e,n=null)=>{if(n)n=s.systemOps[n][0];else if((n=((t,e)=>{let n,r=1/0;for(let o=t;o<=e;o++)s.ops[o].gasLeft<=r&&(n=o,r=s.ops[o].gasLeft);return n})(t,e))===e)return a(t,e);const{rootBegin:r,rootEnd:o}=(t=>{const e=s.findIndex(t);let n=e,r=e;const o=s.systemOps.length;for(;n&&s.systemOps[n][1];)--n;for(;r<o&&s.systemOps[r][1];)++r;return{rootBegin:s.systemOps[n][0],rootEnd:s.systemOps[r-1][0]+1}})(n);let{parentBegin:i,parentEnd:p}=c(n),f=0;for(;r!==i&&o!==p;){const t=s.ops[i],e=t.opcode.fee,o=a(i,p)-e,d=o+Math.floor(o/63),g=d-o;f=d+e;const m=s.findIndex(n)+1,b=i,y=p;({parentBegin:i,parentEnd:p}=c(s.systemOps[m][0])),n=p-1,f+=u(s.ops[i+1])-u(s.ops[b]);const k=u(s.ops[p-1])-u(s.ops[p])+u(s.ops[i])-s.ops[i].opcode.fee-u(s.ops[i+1]),v=h(y,n)+k;let x=g;"CALL"===t.opcode.name&&l(s.ops[r+1])&&(x=2300),x<v&&(f=0)}const d=s.ops[r],g=d.opcode.fee;f||(f=a(r,o)-g);const m=f+Math.floor(f/63);let b=m+g;b+=a(t,r);const y=m-f,k=h(o,e);return"CALL"===d.opcode.name&&l(s.ops[r+1])?b-k:y>k?b:(b-=y)+k}});const o=()=>{const t=[],e=[],n=[],r=t=>["CALL","DELEGATECALL","STATICCALL","CALLCODE"].includes(t),o=t=>["STOP","RETURN","REVERT","INVALID","SELFDESTRUCT"].includes(t),i={};let s,a=1/0,c=0,u=!1,l=0;return{collect:h=>{const p=h.gasLeft.toNumber();a>p&&(a=p,c=e.length,s=t.length),u&&(h.depth===l&&n.push(e.length),u=!1),r(h.opcode.name)?(u=!0,l=h.depth,i[e.length]=t.length,t.push([e.length,h.depth,h.opcode.name])):((t=>["CREATE"].includes(t))(h.opcode.name)||o(h.opcode.name))&&(i[e.length]=t.length,t.push([e.length,h.depth,h.opcode.name])),e.push(h)},findIndex:t=>i[t],lowestGasIndex:()=>c,sysOpIndex:()=>s,lastSVT:()=>n.length?n[n.length-1]:-1,success:()=>!e.length||o(e[e.length-1].opcode.name),ops:e,systemOps:t,simpleValueTransfers:n,isTerminator:o,isCall:r}}},function(t,e,n){var r=n(19),o=n(8),i=n(11),s=n(12),a=n(13),c=n(3),u=n(66),l=n(16),h=n(0),p=n(10),f=n(2),d=n(5);function g(t){if(this.options=t||{},null==t.fork)throw new Error("ForkedBlockchain must be passed a fork parameter.");if(this.fork=t.fork,this.forkBlockNumber=t.fork_block_number,this.forkVersion=null,"string"==typeof this.fork){if(this.fork.indexOf("@")>=0){var e=this.fork.split("@");this.fork=e[0],this.forkBlockNumber=parseInt(e[1])}this.fork=new l.providers.HttpProvider(this.fork)}this.time=t.time,this.storageTrieCache={},r.call(this,t),this.createVMFromStateTrie=function(){var t=r.prototype.createVMFromStateTrie.apply(this,arguments);return this.patchVM(t),t},this.web3=new l(this.fork)}(0,n(1).inherits)(g,r),g.prototype.initialize=function(t,e){var n=this;this.web3.eth.net.getId(function(o,i){if(o)return e(o);n.forkVersion=i,r.prototype.initialize.call(n,t,e)})},g.prototype.patchVM=function(t){const e=t.stateManager._trie,n=this.getLookupAccount(e);t.stateManager._cache._lookupAccount=n,t.stateManager._lookupStorageTrie=this.getLookupStorageTrie(e,n),t.stateManager.getContractCode=this.getCode.bind(this)},g.prototype.createStateTrie=function(t,e){return new u(t,e,{fork:this.fork,forkBlockNumber:this.forkBlockNumber,blockchain:this})},g.prototype.createGenesisBlock=function(t){var e=this,n=this.forkBlockNumber||"latest";e.web3.eth.getBlock(n,function(r,o){if(r)return t(r);!e.time&&e.forkBlockNumber&&(e.time=e.options.time=new Date(1e3*h.number(o.timestamp)),e.setTime(e.time)),n=h.hex(o.number),e.forkBlockNumber=e.options.fork_block_number=n,e.stateTrie.forkBlockNumber=e.stateTrie.options.forkBlockNumber=n,e.createBlock(function(e,n){if(e)return t(e);n.header.number=c.toBuffer(h.number(o.number)+1),n.header.parentHash=c.toBuffer(o.hash),t(null,n)})})},g.prototype.getLookupStorageTrie=function(t,e){return e=e||this.getLookupAccount(t),(n,r)=>{const o=t.copy();o.address=n,e(n,(t,e)=>{if(t)return r(t);o.root=e.stateRoot,r(null,o)})}},g.prototype.isFallbackBlock=function(t,e){var n=this;n.getEffectiveBlockNumber(t,function(t,r){if(t)return e(t);e(null,r<=h.number(n.forkBlockNumber))})},g.prototype.isBlockHash=function(t){return"string"==typeof t&&0===t.indexOf("0x")&&t.length>42||Buffer.isBuffer(t)&&t.byteLength>20},g.prototype.isFallbackBlockHash=function(t,e){if(!this.isBlockHash(t))return e(null,!1);Buffer.isBuffer(t)&&(t=h.hex(t)),this.data.blockHashes.get(t,function(t,n){if(t)return t.notFound?e(null,!0):e(t);e(null,!1)})},g.prototype.getFallbackBlock=function(t,e){this.web3.eth.getBlock(t,!0,function(t,n){if(t)return e(t);if(null==n)return e();var r=new i;r.header.parentHash=c.toBuffer(n.parentHash),r.header.uncleHash=c.toBuffer(n.sha3Uncles),r.header.coinbase=c.toBuffer(n.miner),r.header.stateRoot=c.toBuffer(n.stateRoot),r.header.transactionsTrie=c.toBuffer(n.transactionsRoot),r.header.receiptTrie=c.toBuffer(n.receiptsRoot),r.header.bloom=c.toBuffer(n.logsBloom),r.header.difficulty=c.toBuffer("0x"+n.totalDifficulty.toString(16)),r.header.number=c.toBuffer(n.number),r.header.gasLimit=c.toBuffer(n.gasLimit),r.header.gasUsed=c.toBuffer(n.gasUsed),r.header.timestamp=c.toBuffer(n.timestamp),r.header.extraData=c.toBuffer(n.extraData),(n.transactions||[]).forEach(function(t,e){r.transactions.push(p.fromJSON(t,p.types.real))}),r.hash=function(){return c.toBuffer(n.hash)},e(null,r)})},g.prototype.getBlock=function(t,e){let n;const o=this.isBlockHash(t);(n=o?this.isFallbackBlockHash:this.isFallbackBlock).call(this,t,(n,i)=>{if(n)return e(n);if(i)return this.getFallbackBlock(t,e);const s=r.prototype.getBlock.bind(this);o?s(t,e):this.getRelativeBlockNumber(t,(t,n)=>{if(t)return e(t);s(n,e)})})},g.prototype.getStorage=function(t,e,n,r){this.getLookupStorageTrie(this.stateTrie)(t,(t,o)=>{if(t)return r(t);this.getEffectiveBlockNumber(n,(t,n)=>{if(t)return r(t);o.get(e,n,r)})})},g.prototype.getCode=function(t,e,n){var o=this;"function"==typeof e&&(n=e,e="latest"),e||(e="latest"),this.getEffectiveBlockNumber(e,function(i,s){if(i)return n(i);e=s,o.stateTrie.keyExists(t,function(i,s){if(i)return n(i);s&&e>h.number(o.forkBlockNumber)?r.prototype.getCode.call(o,t,e,n):(e>h.number(o.forkBlockNumber)&&(e="latest"),o.fetchCodeFromFallback(t,e,function(t,e){e&&(e=c.toBuffer(e)),n(t,e)}))})})},g.prototype.getLookupAccount=function(t){return(e,n)=>{t.keyExists(e,(r,i)=>{if(r)return n(r);i?t.get(e,(t,e)=>{if(t)return n(t);const r=new o(e);n(null,r)}):this.fetchAccountFromFallback(e,h.number(this.forkBlockNumber),n)})}},g.prototype.getAccount=function(t,e,n){var o=this;"function"==typeof e&&(n=e,e="latest"),this.getEffectiveBlockNumber(e,function(i,s){if(i)return n(i);e=s,o.stateTrie.keyExists(t,function(i,s){if(i)return n(i);s&&e>h.number(o.forkBlockNumber)?r.prototype.getAccount.call(o,t,e,function(t,e){if(t)return n(t);n(null,e)}):o.fetchAccountFromFallback(t,e,n)})})},g.prototype.getTransaction=function(t,e){var n=this;r.prototype.getTransaction.call(this,t,function(r,o){return r?e(r):null!=o?e(null,o):void n.web3.eth.getTransaction(t,function(t,n){if(t)return e(t);n&&(n=p.fromJSON(n,p.types.signed)),e(null,n)})})},g.prototype.getTransactionReceipt=function(t,e){var n=this;r.prototype.getTransactionReceipt.call(this,t,function(r,o){return r?e(r):o?e(null,o):void n.web3.eth.getTransactionReceipt(t,function(r,o){return r?e(r):o?void f.parallel({tx:n.getTransaction.bind(n,t),block:n.getBlock.bind(n,o.blockNumber)},function(t,n){if(t)return e(t);var r=o.logs.map(function(t){return new s(t)}),i=new a(n.tx,n.block,r,o.gasUsed,o.cumulativeGasUsed,o.contractAddress,o.status,h.hex(o.logsBloom));e(null,i)}):e()})})},g.prototype.fetchAccountFromFallback=function(t,e,n){var r=this;t=h.hex(t),f.parallel({code:this.fetchCodeFromFallback.bind(this,t,e),balance:this.fetchBalanceFromFallback.bind(this,t,e),nonce:this.fetchNonceFromFallback.bind(this,t,e)},function(t,e){if(t)return n(t);var i=e.code,s=e.balance,a=e.nonce,u=new o({nonce:a,balance:s});u.setCode(r.stateTrie,c.toBuffer(i),function(t){if(t)return n(t);n(null,u)})})},g.prototype.fetchCodeFromFallback=function(t,e,n){var r=this;t=h.hex(t),"function"==typeof e&&(n=e,e=this.forkBlockNumber),this.getSafeFallbackBlockNumber(e,function(e,o){if(e)return n(e);r.web3.eth.getCode(t,o,function(t,e){if(t)return n(t);e="0x"+c.toBuffer(e).toString("hex"),n(null,e)})})},g.prototype.fetchBalanceFromFallback=function(t,e,n){var r=this;t=h.hex(t),"function"==typeof e&&(n=e,e=this.forkBlockNumber),this.getSafeFallbackBlockNumber(e,function(e,o){if(e)return n(e);r.web3.eth.getBalance(t,o,function(t,e){if(t)return n(t);e="0x"+new d(e).toString(16),n(null,e)})})},g.prototype.fetchNonceFromFallback=function(t,e,n){var r=this;t=h.hex(t),"function"==typeof e&&(n=e,e=this.forkBlockNumber),this.getSafeFallbackBlockNumber(e,function(e,o){if(e)return n(e);r.web3.eth.getTransactionCount(t,o,function(t,e){if(t)return n(t);e="0x"+r.web3.utils.toBN(e).toString(16),n(null,e)})})},g.prototype.getHeight=function(t){this.latestBlock(function(e,n){if(e)return t(e);t(null,h.number(n.header.number))})},g.prototype.getRelativeBlockNumber=function(t,e){var n=this;this.getEffectiveBlockNumber(t,function(t,r){if(t)return e(t);e(null,r-h.number(n.forkBlockNumber)-1)})},g.prototype.getSafeFallbackBlockNumber=function(t,e){var n=h.number(this.forkBlockNumber);if(null==t)return e(null,n);this.getEffectiveBlockNumber(t,function(t,r){if(t)return e(t);r>n&&(r=n),e(null,r)})},g.prototype.getBlockLogs=function(t,e){var n=this;this.getEffectiveBlockNumber(t,function(o,i){if(o)return e(o);n.getRelativeBlockNumber(i,function(o,i){if(o)return e(o);i<0?n.getBlock(t,function(r,o){if(r)return e(r);n.web3.currentProvider.send({jsonrpc:"2.0",method:"eth_getLogs",params:[{fromBlock:h.hex(t),toBlock:h.hex(t)}],id:(new Date).getTime()},function(t,n){if(t)return e(t);var r=n.result.map(function(t){return t.block=o,new s(t)});e(null,r)})}):r.prototype.getBlockLogs.call(n,i,e)})})},t.exports=g},function(t,e,n){const r=n(20),o=n(67),i=n(68);var s=n(3),a=n(1).inherits,c=n(16),u=n(0);function l(t,e,n){o.call(this,t,e),this.options=n,this.address=n.address,this.forkBlockNumber=n.forkBlockNumber,this.blockchain=n.blockchain,this.fork=n.fork,this.web3=new c(this.fork)}function h(t,e,n){l.call(this,t,e,n),i(this)}a(l,o),l.prototype.get=function(t,e,n){var o=this;"function"==typeof e&&(n=e,e=o.forkBlockNumber),e=u.rpcQuantityHexString(e),t=s.toBuffer(t),this.keyExists(t,function(i,a){if(i)return n(i);a?r.prototype.get.call(o,t,function(t,e){n(t,e)}):null==o.address?o.blockchain.fetchAccountFromFallback(t,e,function(t,e){if(t)return n(t);n(null,e.serialize())}):(u.number(e)>u.number(o.forkBlockNumber)&&(e=o.forkBlockNumber),o.web3.eth.getStorageAt(u.hex(o.address),u.hex(t),e,function(t,e){if(t)return n(t);e=s.rlp.encode(e),n(null,e)}))})},l.prototype.keyExists=function(t,e){t=s.toBuffer(t),this.findPath(t,function(t,n,r,o){const i=n&&0===r.length;e(t,i)})},l.prototype.copy=function(){return new l(this.db,this.root,this.options)},a(h,l),h.prove=r.prove,h.verifyProof=r.verifyProof,t.exports=h},function(t,e){t.exports=require("merkle-patricia-tree/baseTrie")},function(t,e){t.exports=require("merkle-patricia-tree/checkpoint-interface")},function(t){t.exports={name:"web3",namespace:"ethereum",version:"1.0.0-beta.35",description:"Ethereum JavaScript API",repository:"https://github.com/ethereum/web3.js/tree/master/packages/web3",license:"LGPL-3.0",main:"src/index.js",types:"index.d.ts",bugs:{url:"https://github.com/ethereum/web3.js/issues"},keywords:["Ethereum","JavaScript","API"],author:"ethereum.org",authors:[{name:"Fabian Vogelsteller",email:"fabian@ethereum.org",homepage:"http://frozeman.de"},{name:"Marek Kotewicz",email:"marek@parity.io",url:"https://github.com/debris"},{name:"Marian Oancea",url:"https://github.com/cubedro"},{name:"Gav Wood",email:"g@parity.io",homepage:"http://gavwood.com"},{name:"Jeffery Wilcke",email:"jeffrey.wilcke@ethereum.org",url:"https://github.com/obscuren"}],dependencies:{"web3-bzz":"1.0.0-beta.35","web3-core":"1.0.0-beta.35","web3-eth":"1.0.0-beta.35","web3-eth-personal":"1.0.0-beta.35","web3-net":"1.0.0-beta.35","web3-shh":"1.0.0-beta.35","web3-utils":"1.0.0-beta.35"},_resolved:"https://registry.npmjs.org/web3/-/web3-1.0.0-beta.35.tgz",_integrity:"sha512-xwDmUhvTcHQvvNnOPcPZZgCxKUsI2e+GbHy7JkTK3/Rmnutazy8x7fsAXT9myw7V1qpi3GgLoZ3fkglSUbg1Mg==",_from:"web3@1.0.0-beta.35"}},function(t,e){t.exports=require("web3-core")},function(t,e){t.exports=require("web3-eth")},function(t,e){t.exports=require("web3-net")},function(t,e){t.exports=require("web3-eth-personal")},function(t,e){t.exports=require("web3-shh")},function(t,e){t.exports=require("web3-bzz")},function(t,e){t.exports=require("web3-utils")},function(t,e){t.exports=require("eth-sig-util")},function(t,e){t.exports={randomBytes:function(t,e){for(var n=[],r=0;r<t;r++)n.push(255*e());return Buffer.from(n)},randomAlphaNumericString:function(t,e){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(var o=0;o<t;o++)r+=n.charAt(Math.floor((e||Math.random)()*n.length));return r}}},function(t){t.exports={name:"ganache-core",version:"2.5.5",main:"./index.js",engines:{node:">=8.9.0"},directories:{lib:"./lib"},scripts:{_mocha:"mocha --check-leaks --recursive --globals _scratch,sanitizedData --opts ./test/.mocharc",nyc_mocha:"nyc mocha --check-leaks --recursive --globals _scratch,sanitizedData --opts ./test/.mocharc",_lint:"eslint --ignore-path .gitignore .",build:"webpack-cli --config ./webpack/node/core.webpack.config.js","build-web":"webpack-cli --config ./webpack/web-experimental/core.webpack.config.js",format:'prettier --write "{lib,perf,test}/**/*.js" && eslint --fix --ignore-path .gitignore .',prepublishOnly:"npm run test && npm run build && npm run test-build && cp npm-shrinkwrap.json npm-shrinkwrap.json.bak && npm prune --only=prod",postpublish:"rm npm-shrinkwrap.json && mv npm-shrinkwrap.json.bak npm-shrinkwrap.json && npm ci",test:"npm run _lint && npm run nyc_mocha","test-build":"cross-env TEST_BUILD=node npm run _mocha","test-web-experimental":"cross-env TEST_BUILD=web-experimental npm run _mocha",coverage:"nyc report --reporter=text-lcov | coveralls"},dependencies:{"abstract-leveldown":"3.0.0",async:"2.6.1",bip39:"2.5.0","bn.js":"4.11.8",cachedown:"1.0.0",clone:"2.1.2",debug:"3.1.0","encoding-down":"5.0.4","eth-sig-util":"2.0.2","ethereumjs-abi":"0.6.5","ethereumjs-account":"2.0.5","ethereumjs-block":"2.1.0","ethereumjs-tx":"1.3.7","ethereumjs-util":"5.2.0","ethereumjs-vm":"2.6.0",heap:"0.2.6","level-sublevel":"6.6.4",levelup:"3.1.1",lodash:"4.17.11","merkle-patricia-tree":"2.3.1",rlp:"2.1.0",seedrandom:"2.4.4","source-map-support":"0.5.9",tmp:"0.0.33","web3-provider-engine":"14.1.0",websocket:"1.0.26"},devDependencies:{"assert-match":"^1.1.1",browserfs:"1.4.3",coveralls:"^3.0.2","cross-env":"5.2.0",eslint:"5.7.0","eslint-config-standard":"12.0.0","eslint-plugin-import":"2.14.0","eslint-plugin-node":"7.0.1","eslint-plugin-promise":"4.0.1","eslint-plugin-standard":"4.0.0","ethereumjs-wallet":"0.6.2",ethers:"4.0.26",husky:"^1.1.3","lint-staged":"^8.0.4",memdown:"^1.3.1",mocha:"5.2.0","mocha-lcov-reporter":"^1.3.0","number-to-bn":"1.7.0",nyc:"13.3.0",pify:"4.0.0",portfinder:"^1.0.18",prettier:"^1.14.3",request:"^2.88.0",semver:"5.6.0",solc:"0.4.24",temp:"0.8.3",web3:"1.0.0-beta.35",webpack:"4.17.1","webpack-bundle-size-analyzer":"2.7.0","webpack-cli":"3.1.0"},optionalDependencies:{"ethereumjs-wallet":"0.6.2",web3:"1.0.0-beta.35"},repository:{type:"git",url:"https://github.com/trufflesuite/ganache-core"},license:"MIT",husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.js":["prettier --write","eslint --fix --ignore-path .gitignore","git add"]},eslintConfig:{root:!0,env:{node:!0,es6:!0},parserOptions:{ecmaVersion:8,sourceType:"module",ecmaFeatures:{impliedStrict:!0}},extends:"standard",rules:{"brace-style":["error","1tbs",{allowSingleLine:!1}],curly:["error","all"],"max-len":["error",120,{ignoreRegExpLiterals:!0}],quotes:["error","double"],semi:["error","always"],"space-before-function-paren":["error","never"],"wrap-iife":["error","outside"]}},prettier:{printWidth:120,arrowParens:"always"}}},function(t,e,n){const r=n(15);var o=n(24);function i(t){if(t=t||{},r.apply(this),!t.blockchain)throw new Error("RpcBlockTracker - no blockchain specified.");if(!t.blockchain.on)throw new Error("RpcBlockTracker - blockchain is not an EventEmitter.");this._blockchain=t.blockchain,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.getTrackingBlock=this.getTrackingBlock.bind(this),this.awaitCurrentBlock=this.awaitCurrentBlock.bind(this),this._setCurrentBlock=this._setCurrentBlock.bind(this)}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.getTrackingBlock=function(){return this._currentBlock},i.prototype.getCurrentBlock=function(){return this._currentBlock},i.prototype.awaitCurrentBlock=function(){const t=this;return this._currentBlock?this._currentBlock:new Promise(t=>this.once("block",t)).then(()=>t._currentBlock)},i.prototype.start=function(t={}){return this._blockchain.on("block",this._setCurrentBlock),Promise.resolve()},i.prototype.stop=function(){this._isRunning=!1,this._blockchain.removeListener("block",this._setCurrentBlock)},i.prototype._setCurrentBlock=function(t){let e=o.toJSON(t,!0);if(this._currentBlock&&this._currentBlock.hash===e.hash)return;const n=this._currentBlock;this._currentBlock=e,this.emit("latest",e),this.emit("sync",{block:e,oldBlock:n}),this.emit("block",e)},t.exports=i},function(t,e,n){n(7);var r=n(17),o=n(82),i=n(84),s=n(6);t.exports={create:function(t){var e=(t=c(t||{})).logger,n=new r(t),s=i(n,e);s.keepAliveTimeout=t.keepAliveTimeout;let a=0;const u={};s.on("connection",t=>{let e=a++;u[e]=t,t.on("close",()=>delete u[e])});var l=s.listen;s.listen=function(){var t=Array.prototype.slice.call(arguments),e=function(){};t.length>0&&("function"==typeof t[t.length-1]&&(e=t.pop()));t.push(function(t){if(t)return e(t);s.provider.manager.waitForInitialization(e)}),l.apply(s,t)},s.provider=n,t.ws&&o(s,n,e);var h=s.close;return s.close=function(t){var e=Array.prototype.slice.call(arguments);h.apply(s,e),s.provider.close(function(e){if(e)return t(e);Object.keys(u).forEach(t=>{try{u[t].destroy()}catch(t){}})})},s}};const a={logger:{log:function(){}},ws:!0,keepAliveTimeout:5e3};var c=function(t){return s.merge({},a,t)}},function(t,e,n){var r=n(83).server;function o(t,e){const n=this;n.provider=t,n.logger=e,n.connectionsBySubscriptionId={},n.connections={},n.connectionCounter=0,n._updateSubscriptions=n._updateSubscriptions.bind(n),n.manageConnection=n.manageConnection.bind(n),n._logPayload=n._logPayload.bind(n),n._handleRequest=n._handleRequest.bind(n),t.on("data",function(t,e){t||n._updateSubscriptions(e)})}t.exports=function(t,e,n){var i=new o(e,n),s=new r({httpServer:t,autoAcceptConnections:!0});return s.on("connect",i.manageConnection),s},o.prototype.manageConnection=function(t){const e=this;t.id=++e.connectionCounter,e.connections[t.id]={connection:t,subscriptions:{}},t.on("message",function(n){try{var r=JSON.parse(n.utf8Data)}catch(e){t.reject(400,"Bad Request")}e._logPayload(r),e._handleRequest(t,r)}),t.on("close",function(){Object.keys(e.connections[t.id].subscriptions).forEach(t=>{e.provider.send({jsonrpc:"2.0",method:"eth_unsubscribe",params:[t],id:(new Date).getTime()},function(n,r){n||delete e.connectionsBySubscriptionId[t]})}),delete e.connections[t.id]})},o.prototype._handleRequest=function(t,e){const n=this;switch(e.method){case"eth_subscribe":n.provider.send(e,function(e,r){!e&&r.result&&n.connections[t.id]&&(n.connections[t.id].subscriptions[r.result]=!0,n.connectionsBySubscriptionId[r.result]=n.connections[t.id]),t.send(JSON.stringify(r))});break;case"eth_unsubscribe":n.provider.send(e,function(r,o){r||o.error?t&&t.send&&t.send(JSON.stringify(o)):(n.connections[t.id]&&delete n.connections[t.id].subscriptions[e.params[0]],delete n.connectionsBySubscriptionId[e.params[0]],t.send(JSON.stringify(o)))});break;default:n.provider.send(e,function(e,n){t.send(JSON.stringify(n))})}},o.prototype._logPayload=function(t){const e=this;if(t instanceof Array)for(var n=0;n<t.length;n++){var r=t[n];e.logger.log(r.method)}else e.logger.log(t.method)},o.prototype._updateSubscriptions=function(t){const e=this.connectionsBySubscriptionId[t.params.subscription];e&&e.connection.send(JSON.stringify(t))}},function(t,e){t.exports=require("websocket")},function(t,e,n){const r=n(85),{rpcError:o}=n(0);function i(t,e,n,r){t.writeHead(e,n),t.end(r)}t.exports=function(t,e){var n=r.createServer(function(n,r){var s=n.method,a=[];n.on("data",function(t){a.push(t)}).on("end",function(){a=Buffer.concat(a).toString();const c=function(t,e){const n={};return e.hasOwnProperty("origin")&&("OPTIONS"===t&&(n["Access-Control-Allow-Methods"]="POST",e.hasOwnProperty("access-control-request-headers")&&(n["Access-Control-Allow-Headers"]=e["access-control-request-headers"]),n["Content-Length"]=0,n["Access-Control-Max-Age"]=600),n["Access-Control-Allow-Credentials"]=!0,n["Access-Control-Allow-Origin"]=e.origin),n}(s,n.headers);switch(s){case"POST":var u;try{u=JSON.parse(a)}catch(t){return c["Content-Type"]="text/plain",void i(r,400,c,"400 Bad Request")}if(u instanceof Array)for(var l=0;l<u.length;l++){var h=u[l];e.log(h.method)}else e.log(u.method);if("eth_subscribe"===u.method||"eth_unsubscribe"===u.method){c["Content-Type"]="application/json",i(r,400,c,o(u.id,-32e3,"notifications not supported"));break}t.send(u,function(t,e){c["Content-Type"]="application/json",i(r,200,c,JSON.stringify(e))});break;case"OPTIONS":i(r,204,c);break;default:c["Content-Type"]="text/plain",i(r,400,c,"400 Bad Request")}})});return n.ganacheProvider=t,n}},function(t,e){t.exports=require("http")}])});
//# sourceMappingURL=ganache.core.node.js.map